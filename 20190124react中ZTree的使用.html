<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>react中ZTree的使用 |sumerzhou's blog</title>
    <link href="myblog.css" rel="stylesheet" type="text/css">
    <script src="myblog.js" type="text/javascript"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        .textBox{
            width: 980px;
            border-radius: 20px;
            position: relative;
            padding: 10px;
            top: 105px;
            line-height: 2em;
        }
        .textBox h2{
            margin-top: 10px;
            text-indent: 2em;
            text-shadow: 2px 2px 1px dodgerblue;
        }
        .textBox h3{
            margin-top: 10px;
            border-bottom:1px solid lightblue;
            box-shadow: 2px 2px 1px black;
        }
        .textBox h4{
            text-shadow: 1px 1px 2px #4F68B0;
        }
        .textBox p{
            text-indent: 2em;
        }
        .textBox li{
            text-indent: 2em;
            list-style: none;
        }
        .textBox pre{
            display: block;
            width: 850px;
            border-left: 1px solid black;
            border-right: 1px solid black;
            box-shadow: 4px 3px 2px black;
            padding-left: 30px;
            position: relative;
            left: -30px;
            font-family: '仿宋';
            background-color: rgb(40,44,52);
            line-height: 1.5;
            font-size: 15px;
            color:white;
            overflow-y: auto;
        }
        .highlight{
            background-color: rgb(255,243,212);
        }
    </style>
</head>
<body>
<!--header-->
<div class="headerbox">
    <div class="headertop">
        <div class="hdtopbut">
            <a href="http://blog.hungking.cc/" target="_blank"><img src="imgs/sns_blog_off.png"></a>
            <a href="https://www.facebook.com/HoungkingHsi" target="_blank"><img src="imgs/sns_facebook_off.png"></a>
            <a href="http://globalblog.hungking.cc/" target="_blank"><img src="imgs/sns_gBlog_off.png"></a>
            <a href="http://www.linkedin.com/imisslovelove" target="_blank"><img src="imgs/sns_in_off.png"></a>
            <a href="http://www.youtube.com/imisslovelove" target="_blank"><img src="imgs/sns_youTube_off.png"></a>
            <a href="http://www.instagram.com/imisslovelove" target="_blank"><img src="imgs/sns_instagram_off.png"></a>
            <a href="http://story.kakao.com/ch/imisslovelove" target="_blank" style="background: transparent none;"><img src="imgs/sns_kakao_off.png"></a>
            <div class="hdtopbutR">
                <a href="construction.html" style="background-position-x:85px ;">Contact Me</a>
                <a href="construction.html">AboutSite</a>
                <span onclick="ifshow(0)">Language<img src="imgs/btn_globalSite_open.gif"></span>
                <ul id="lag">
                    <li>KOREAN</li><li>CHINESE</li><li>JAPANESE</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="headerbotm">
        <a class="logohome" href="http://www.hungking.cc/company"><img src="imgs/blog.png"></a>
        <ul id="hdbotmUl">
            <li>
                <a href="company.html">WEB前端</a>
                <ul class="ultext1">
                    <li>
                        <a href="">HTML</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Corporate Overview</a></li>
                                <li><a href="">Vision of houngking</a></li>
                                <li><a href="">History of houngking</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">CSS/CSS3</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Brand Story</a></li>
                                <li><a>CI</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">JavaScript</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Greetings</a></li>
                                <li><a>CEO's Message</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Ajax</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>hougking Affiliates</a></li>
                                <li><a>Steel</a></li>
                                <li><a>E&C</a></li>
                                <li><a>Trade</a></li>
                                <li><a>ICT</a></li>
                                <li><a>Energy</a></li>
                                <li><a>Material-Chemistry</a></li>
                                <li><a>Support</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">jQuery</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Global</a></li>
                                <li><a>Asia</a></li>
                                <li><a>America</a></li>
                                <li><a>Europe&Africa</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Business Ethics</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Code of Ethics</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">CEO Message</a></li>
                                <li><a href="">Ethics Charter</a></li>
                                <li><a href="">Practice Guidelines</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Major Activities</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Operation of the Ethical Management System</a></li>
                                <li><a href="">Education on Corporate Ethics</a></li>
                                <li><a href="">Unethical Act Prevention System</a></li>
                                <li><a href="">External Activities and Results</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Products/Technology</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Products of hounking</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Hot Rolled Steel</a></li>
                                <li><a href="">Steel Plate</a></li>
                                <li><a href="">Winter Day</a></li>
                                <li><a href="">Gold Rolled Steel</a></li>
                                <li><a href="">Galvanized Steel</a></li>
                                <li><a href="">Electrical Galvanized</a></li>
                                <li><a href="">Electrical Steel</a></li>
                                <li><a href="">Automotive materials</a></li>
                                <li><a href="">Stainless Steel</a></li>
                                <li><a href="">Titanium Product</a></li>
                                <li><a href="">Magnesium Product</a></li>
                                <li><a href="">Aluminum-plated products</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">houngking Technology</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">FINEX Technology</a></li>
                                <li><a href="">Strip Casting</a></li>
                                <li><a href="">Endless Hot Rolling Technology</a></li>
                                <li><a href="">Operation Technology</a></li>
                                <li><a href="">CEM Technology</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Production Process</a>
                    </li>
                    <li>
                        <a href="">Sales information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">e-Sales</a></li>
                                <li><a href="">e-Procurement</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Investor Relations</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">IR Activeties</a>
                    </li>
                    <li>
                        <a href="">Stock Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Stock Price</a></li>
                                <li><a href="">Price Comparision</a></li>
                                <li><a href="">ADR</a></li>
                                <li><a href="">houngking Stock Exchange</a></li>
                                <li><a href="">Economic Trend</a></li>
                                <li><a href="">Shareholders Demographics</a></li>
                                <li><a href="">Dividend</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Financial Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Income Statement</a></li>
                                <li><a href="">Credit Rating</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">IR Archive</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Audit Report</a></li>
                                <li><a href="">Form 20-F</a></li>
                                <li><a href="">Annual Report</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Sustainability</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Sustainability Management System</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Management System</a></li>
                                <li><a href="">houngking Subsidiaries CSR Assessment</a></li>
                                <li><a href="">Risk Management</a></li>
                                <li><a href="">Stakeholder</a></li>
                                <li><a href="">Relevant Institutes Activities</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Social Responsibility </a>
                    </li>
                    <li>
                        <a href="">Environmental Management </a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Family's Environmental Management</a></li>
                                <li><a href="">Environmental Management</a></li>
                                <li><a href="">Climate change /Energy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Customer</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Marketing strategy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Employee</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Employee Health / Safety</a></li>
                                <li><a href="">Organizational Culture</a></li>
                                <li><a href="">HR system</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Report</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Report</a></li>
                                <li><a href="">Carbon Report</a></li>
                                <li><a href="">Conflict Minerals Disclosure</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">PR Room</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">News room</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">News letter</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">houngking SNS</a>
                    </li>
                    <li>
                        <a href="">PR Archives</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Digital Brochure</a></li>
                                <li><a href="">TV Cormmercials</a></li>
                                <li><a href="">Screen Saver</a></li>
                                <li><a href="">PR Movies</a></li>
                                <li><a href="">Printed Advertisement</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Download</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Company</a></li>
                                <li><a href="">Products/Technology</a></li>
                                <li><a href="">Investor Relations</a></li>
                                <li><a href="">Sustainability</a></li>
                                <li><a href="">PR Room</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <img src="imgs/btn_gnb.png" class="imgbtn" id="imgbtn" onclick="ifshow(1)">
        <img src="imgs/btn_search.png" class="imgbtn2" onclick="ifshow(2)">
        <div class="hdmenu" id="hdmenu">
            <a href="">Open submenu</a>
            <ul class="menutxt1">
                <li>
                    <a href="">Company</a>
                    <ul>
                        <li><a href="">Corporate Overview</a></li>
                        <li><a href="">Brand</a></li>
                        <li><a href="">CEO</a></li>
                        <li><a href="">hounking Affiliates</a></li>
                        <li><a href="">hounking Overseas</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Business Ethics</a>
                    <ul>
                        <li><a href="">Code of Ethics</a></li>
                        <li><a href="">Major Activities</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Products/Technology</a>
                    <ul>
                        <li><a href="">Products of houngking</a></li>
                        <li><a href="">hounking Technology</a></li>
                        <li><a href="">Production Process</a></li>
                        <li><a href="">Sales informtion</a></li>
                    </ul>
                </li>
                <li style="padding: 0px;">
                    <a href="">Investor Relations</a>
                    <ul>
                        <li><a href="">IR Activities</a></li>
                        <li><a href="">Stock Information</a></li>
                        <li><a href="">Financial Information</a></li>
                        <li><a href="">IR Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Sustainability</a>
                    <ul>
                        <li><a href="">Suatainability Management System</a></li>
                        <li><a href="">Social Redponsibility</a></li>
                        <li><a href="">Environmental Management</a></li>
                        <li><a href="">Customer</a></li>
                        <li><a href="">Employee</a></li>
                        <li><a href="">Report</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">PR Room</a>
                    <ul>
                        <li><a href="">Newsroom</a></li>
                        <li><a href="">Newsletter</a></li>
                        <li><a href="">houngking SNS</a></li>
                        <li><a href="">PR Archives</a></li>
                        <li><a href="">Download</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Contact Us</a>
                    <ul>
                        <li><a href="">Q&A</a></li>
                        <li><a href="">Search</a></li>
                        <li><a href="">Location</a></li>
                        <li><a href="">Sitemap</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--text-->
<div class="textBox">
    <h2>react中ZTree的使用 </h2>
    <h3>1,前言</h3>
    <p>zTree 是一个依靠 jQuery 实现的多功能 “树插件”。优异的性能、灵活的配置、多种功能的组合是 zTree 最大优点。</p>
    <p>zTree v3.x 将核心代码按照功能进行了分割，不需要的代码可以不用加载。采用了 延迟加载 技术，上万节点轻松加载，即使在 IE6 下也能基本做到秒杀。</p>
    <p>兼容 IE、FireFox?、Chrome、Opera、Safari 等浏览器。支持 JSON 数据,支持静态 和 Ajax 异步加载节点数据,支持任意更换皮肤 / 自定义图标。</p>
    <p>ztree官网-- <a href="http://www.treejs.cn/v3/main.php" target="_blank">http://www.treejs.cn/v3/main.php</a></p>
    <p>使用antd自带的tree控件有很多需求不能实现，比如手动修改节点后部分刷新功能，还有懒加载的情况下修改某个节点，实现局部刷新，自己写插件成本又大，干脆直接使用ztree,ztree的强大相信大家都知道 。</p>
    <p>手上项目环境: 项目中之前已经安装了bootstrap3.3.7和jquery3.3.1。</p>
    <p>npm上zTree地址: <a href="https://www.npmjs.com/package/ztree" target="_blank">https://www.npmjs.com/package/ztree</a></p>
    <p>git上zTree地址: <a href="https://github.com/zTree/zTree_v3" target="_blank">https://github.com/zTree/zTree_v3</a></p>
    <h3>2, 核心的函数和属性介绍</h3>

    <h3>3,实践过程</h3>
    <p>1， 添加jquery</p>
    <pre>import $ from 'jquery'</pre>
    <p>2. 下载ztree，引入ztree</p>
    <pre>
npm install ztree
//npm install ztree安装的是V3.5.24；
//git上提供了npm install @ztree/ztree_v3来安装最新版

import zTree from 'ztree';

//样式文件一定不要忘了引入，不然会没有样式
import 'ztree/css/zTreeStyle/zTreeStyle.css';  </pre>
    <p>3. 组件中初始化ztree</p>
    <pre style="height: 300px;">
componentDidMount(){
    var setting = {
	    view: {
            showIcon: this.showIconForTree,
            showLine:true,
            fontCss : {color:"#666"}
		},
		data: {
			simpleData: {
				enable: true
			}
		}
    };
    var zNodes =[
		{ id:1, pId:0, name:"父节点1 - 展开"},
		{ id:11, pId:1, name:"父节点11 - 折叠"},
		{ id:111, pId:11, name:"叶子节点111"},
		{ id:112, pId:11, name:"叶子节点112"},
		{ id:113, pId:11, name:"叶子节点113"},
    ];
    $.fn.zTree.init($("#tree"), setting, zNodes);
}
showIconForTree(treeId, treeNode) {
    return !treeNode.isParent;
}
render() {
    return (
        &lt;div&gt;
            {/* 类名ztree一定要加上，不然也是没有样式 */}
            &lt;ul id='tree' className="ztree"&gt;&lt;/ul&gt;
        &lt;/div&gt;
    );
} </pre>
    <p>4,封装好的react-zTree demo</p>
    <pre>// tree.jsx
import React from 'react';
import $ from 'jquery';
import zTree from 'ztree';
import 'ztree/css/zTreeStyle/zTreeStyle.css';

/**
 * 组件配置:
 * id               组件树的id，全局唯一
 * zNodes           组件节点数据,Array。
 * checkbox         是否是checkbox
 * editableTree     是否是可编辑树
 * levelMax         树的最大层级结构。根节点level为0;默认为3层结构，levelMax=2
 * onEdit           编辑节点的事件回调函数，需返回false/true，表示取消/确认编辑。
 * onDelete         删除节点的事件回调函数，需返回false/true，表示取消/确认删除.
 * onAddNew         新增一个默认节点的回调函数，需返回false/(true,newNode),表示取消/确认新增;
 *                  接收父节点数据和cb回调函数两个参数:fn(parentNode,cb);
 * onNodeCheck      勾选或取消勾选的事件回调函数,接收两个参数:fn(currentNode,checkedNodes)
 * onNodeClick      在单击节点时接收一个参数为该节点数据
 */
let _zTreeObj = {};
export default class ReactZtree extends React.Component{
    state = {
        levelMax: this.props.levelMax || 2
    };
    componentDidMount(){
        _zTreeObj[this.props.id] = this;
        this.initTree();
    }
    componentDidUpdate(prevProps, prevState){
        console.log('tree did updata zNodes:',this.props.zNodes);
        this.initTree();
    }
    componentWillUnmount(){
        this.ztreeObj && this.ztreeObj.destroy();
    }
    initTree() {
        const { id, zNodes } = this.props;
        this.ztreeObj = $.fn.zTree.init($('#'+id), this.getTreeSetting(), zNodes);
        // console.log('this.ztreeObj init:',this.ztreeObj)
    }
    getTreeSetting() {
        const { props } = this;
        return {
            view: {
                showIcon:false,
                showLine:true,
                fontCss : {color:"#666"},
                addHoverDom: props.editableTree && this.addHoverDom,
                removeHoverDom: props.editableTree && this.removeHoverDom,
                selectedMulti: false
            },
            check: {
                chkStyle: "checkbox",
                enable:props.checkbox
            },
            edit: {
                enable:props.editableTree,
                showRenameBtn: this.showRemoveBtn,
                showRemoveBtn:this.showRemoveBtn
            },
            data: {
                simpleData: {
                    enable: false //true/false 表示使用/不使用简单数据模式(Array)
                }
            },
            callback: {
                beforeRemove: this.beforeRemove,
                beforeRename: this.beforeRename,
                onRename: this.onRename,
                onCheck: this.onCheck,
                onClick: this.onClick
            }
        }
    }
    showRemoveBtn(treeId, treeNode) {
        return treeNode.pid !== 0;
    }
    addHoverDom(treeId, treeNode) {
        if(treeNode.level >= _zTreeObj[treeId].state.levelMax) return;
        let sObj = $("#" + treeNode.tId + "_span");
        if (treeNode.editNameFlag || $("#addBtn_"+treeNode.tId).length>0) return;
        let addStr = "&lt;span class='button add' id='addBtn_" + treeNode.tId
            + "' title='add node' onfocus='this.blur();'&gt;&lt;/span&gt;";
        sObj.after(addStr);
        let btn = $("#addBtn_"+treeNode.tId);
        if (btn) btn.bind("click", function(){
            let cb = function (b, nodeData) {
                b && $.fn.zTree.getZTreeObj(treeId).addNodes(treeNode, nodeData);
            };
            _zTreeObj[treeId].props.onAddNew(treeNode,cb) ;
            return false;
        });
    }
    removeHoverDom(treeId, treeNode) {
        $("#addBtn_"+treeNode.tId).unbind().remove();
    }
    beforeRemove(treeId, treeNode) {
        $.fn.zTree.getZTreeObj(treeId).selectNode(treeNode);
        const confirm = window.confirm("确认删除节点" + treeNode.name + " 吗？");
        return confirm ? _zTreeObj[treeId].props.onDelete(treeNode) : false;
    }
    beforeRename(treeId, treeNode, newName, isCancel) {
        console.log('rename treeNode:',treeNode, 'newName:',newName,'isCancel:',isCancel);
        return isCancel ? true : _zTreeObj[treeId].props.onEdit({...treeNode, name:newName});
    }
    onRename(e, treeId, treeNode, isCancel) {
        console.log('on rename isCancel:',isCancel);
    }
    onCheck(e, treeId, treeNode) {
        let checkedNodes = $.fn.zTree.getZTreeObj(treeId).getCheckedNodes();
        _zTreeObj[treeId].props.onNodeCheck(treeNode, checkedNodes);
    }
    onClick(e, treeId, treeNode) {
        let handler = _zTreeObj[treeId].props.onNodeClick;
        handler && handler(treeNode);
    }

    render() {
        const { id } = this.props;
        return (
            &lt;React.Fragment&gt;
                &lt;ul id={id} className="ztree"&gt;&lt;/ul&gt;
                &lt;style&gt;{`
                .ztree li span.button.add {
                    margin-left:2px;
                    margin-right: -1px;
                    background-position:-144px 0;
                    vertical-align:top;
                    *vertical-align:middle
                }
                `}&lt;/style&gt;
            &lt;/React.Fragment&gt;
        )
    }
}</pre>



    <h3>4, 使用过程中可能会遇到的报错</h3>
    <h4>报错jQuery is not define:</h4>
    <p>在使用react的时候发现引用的ztree会报错，应该是jquery与ztree里面的jquery冲突造成的，网上找到一个解决办法:</p>
    <pre>// 新建 jquery-vendor.js
import $ from 'jquery'
window.$ = $
window.jQuery = $
export default $   </pre>
    <p>使用:</p>
    <pre>
import $ from '../assets/jquery-vendor.js'
import 'jquery-ui'
//  此时UI的方法全部可用，如果需要引用bootstrap，可参照此方法  </pre>


    <br/>
    <h5>参考文档:</h5>
    <a href="https://blog.csdn.net/Chris__wang/article/details/86001063" target="_blank">react中使用ztree</a>,<br>
    <a href="https://blog.csdn.net/Chris__wang/article/details/85782166" target="_blank">react中使用zTree报错jQuery is not define</a>, <br>
    <a href="https://blog.csdn.net/jx950915/article/details/79486807" target="_blank">webpack中使用jquery库</a>,<br>
</div>

</body>
</html>
