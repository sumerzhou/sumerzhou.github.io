<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>react+webpack正式环境打包部署|sumerzhou's blog</title>
    <link href="myblog.css" rel="stylesheet" type="text/css">
    <script src="myblog.js" type="text/javascript"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        .textBox{
            width: 980px;
            border-radius: 20px;
            position: relative;
            padding: 10px;
            top: 105px;
            line-height: 2em;
        }
        .textBox h2{
            margin-top: 10px;
            text-indent: 2em;
            text-shadow: 2px 2px 1px dodgerblue;
        }
        .textBox h3{
            margin-top: 10px;
            border-bottom:1px solid lightblue;
            box-shadow: 2px 2px 1px black;
        }
        .textBox h4{
            text-shadow: 1px 1px 2px #4F68B0;
        }
        .textBox p{
            text-indent: 2em;
        }
        .textBox li{
            text-indent: 2em;
            list-style: none;
        }
        .textBox pre{
            display: block;
            width: 850px;
            border-left: 1px solid black;
            border-right: 1px solid black;
            box-shadow: 4px 3px 2px black;
            padding-left: 30px;
            position: relative;
            left: -30px;
            font-family: '仿宋';
            background-color: rgb(40,44,52);
            line-height: 1.5;
            font-size: 15px;
            color:white;
            overflow-y: auto;
        }
        .highlight{
            background-color: rgb(255,243,212);
        }
    </style>
</head>
<body>
<!--header-->
<div class="headerbox">
    <div class="headertop">
        <div class="hdtopbut">
            <a href="http://blog.hungking.cc/" target="_blank"><img src="imgs/sns_blog_off.png"></a>
            <a href="https://www.facebook.com/HoungkingHsi" target="_blank"><img src="imgs/sns_facebook_off.png"></a>
            <a href="http://globalblog.hungking.cc/" target="_blank"><img src="imgs/sns_gBlog_off.png"></a>
            <a href="http://www.linkedin.com/imisslovelove" target="_blank"><img src="imgs/sns_in_off.png"></a>
            <a href="http://www.youtube.com/imisslovelove" target="_blank"><img src="imgs/sns_youTube_off.png"></a>
            <a href="http://www.instagram.com/imisslovelove" target="_blank"><img src="imgs/sns_instagram_off.png"></a>
            <a href="http://story.kakao.com/ch/imisslovelove" target="_blank" style="background: transparent none;"><img src="imgs/sns_kakao_off.png"></a>
            <div class="hdtopbutR">
                <a href="construction.html" style="background-position-x:85px ;">Contact Me</a>
                <a href="construction.html">AboutSite</a>
                <span onclick="ifshow(0)">Language<img src="imgs/btn_globalSite_open.gif"></span>
                <ul id="lag">
                    <li>KOREAN</li><li>CHINESE</li><li>JAPANESE</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="headerbotm">
        <a class="logohome" href="http://www.hungking.cc/company"><img src="imgs/blog.png"></a>
        <ul id="hdbotmUl">
            <li>
                <a href="company.html">WEB前端</a>
                <ul class="ultext1">
                    <li>
                        <a href="">HTML</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Corporate Overview</a></li>
                                <li><a href="">Vision of houngking</a></li>
                                <li><a href="">History of houngking</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">CSS/CSS3</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Brand Story</a></li>
                                <li><a>CI</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">JavaScript</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Greetings</a></li>
                                <li><a>CEO's Message</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Ajax</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>hougking Affiliates</a></li>
                                <li><a>Steel</a></li>
                                <li><a>E&C</a></li>
                                <li><a>Trade</a></li>
                                <li><a>ICT</a></li>
                                <li><a>Energy</a></li>
                                <li><a>Material-Chemistry</a></li>
                                <li><a>Support</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">jQuery</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Global</a></li>
                                <li><a>Asia</a></li>
                                <li><a>America</a></li>
                                <li><a>Europe&Africa</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Business Ethics</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Code of Ethics</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">CEO Message</a></li>
                                <li><a href="">Ethics Charter</a></li>
                                <li><a href="">Practice Guidelines</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Major Activities</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Operation of the Ethical Management System</a></li>
                                <li><a href="">Education on Corporate Ethics</a></li>
                                <li><a href="">Unethical Act Prevention System</a></li>
                                <li><a href="">External Activities and Results</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Products/Technology</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Products of hounking</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Hot Rolled Steel</a></li>
                                <li><a href="">Steel Plate</a></li>
                                <li><a href="">Winter Day</a></li>
                                <li><a href="">Gold Rolled Steel</a></li>
                                <li><a href="">Galvanized Steel</a></li>
                                <li><a href="">Electrical Galvanized</a></li>
                                <li><a href="">Electrical Steel</a></li>
                                <li><a href="">Automotive materials</a></li>
                                <li><a href="">Stainless Steel</a></li>
                                <li><a href="">Titanium Product</a></li>
                                <li><a href="">Magnesium Product</a></li>
                                <li><a href="">Aluminum-plated products</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">houngking Technology</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">FINEX Technology</a></li>
                                <li><a href="">Strip Casting</a></li>
                                <li><a href="">Endless Hot Rolling Technology</a></li>
                                <li><a href="">Operation Technology</a></li>
                                <li><a href="">CEM Technology</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Production Process</a>
                    </li>
                    <li>
                        <a href="">Sales information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">e-Sales</a></li>
                                <li><a href="">e-Procurement</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Investor Relations</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">IR Activeties</a>
                    </li>
                    <li>
                        <a href="">Stock Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Stock Price</a></li>
                                <li><a href="">Price Comparision</a></li>
                                <li><a href="">ADR</a></li>
                                <li><a href="">houngking Stock Exchange</a></li>
                                <li><a href="">Economic Trend</a></li>
                                <li><a href="">Shareholders Demographics</a></li>
                                <li><a href="">Dividend</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Financial Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Income Statement</a></li>
                                <li><a href="">Credit Rating</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">IR Archive</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Audit Report</a></li>
                                <li><a href="">Form 20-F</a></li>
                                <li><a href="">Annual Report</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Sustainability</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Sustainability Management System</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Management System</a></li>
                                <li><a href="">houngking Subsidiaries CSR Assessment</a></li>
                                <li><a href="">Risk Management</a></li>
                                <li><a href="">Stakeholder</a></li>
                                <li><a href="">Relevant Institutes Activities</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Social Responsibility </a>
                    </li>
                    <li>
                        <a href="">Environmental Management </a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Family's Environmental Management</a></li>
                                <li><a href="">Environmental Management</a></li>
                                <li><a href="">Climate change /Energy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Customer</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Marketing strategy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Employee</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Employee Health / Safety</a></li>
                                <li><a href="">Organizational Culture</a></li>
                                <li><a href="">HR system</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Report</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Report</a></li>
                                <li><a href="">Carbon Report</a></li>
                                <li><a href="">Conflict Minerals Disclosure</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">PR Room</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">News room</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">News letter</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">houngking SNS</a>
                    </li>
                    <li>
                        <a href="">PR Archives</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Digital Brochure</a></li>
                                <li><a href="">TV Cormmercials</a></li>
                                <li><a href="">Screen Saver</a></li>
                                <li><a href="">PR Movies</a></li>
                                <li><a href="">Printed Advertisement</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Download</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Company</a></li>
                                <li><a href="">Products/Technology</a></li>
                                <li><a href="">Investor Relations</a></li>
                                <li><a href="">Sustainability</a></li>
                                <li><a href="">PR Room</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <img src="imgs/btn_gnb.png" class="imgbtn" id="imgbtn" onclick="ifshow(1)">
        <img src="imgs/btn_search.png" class="imgbtn2" onclick="ifshow(2)">
        <div class="hdmenu" id="hdmenu">
            <a href="">Open submenu</a>
            <ul class="menutxt1">
                <li>
                    <a href="">Company</a>
                    <ul>
                        <li><a href="">Corporate Overview</a></li>
                        <li><a href="">Brand</a></li>
                        <li><a href="">CEO</a></li>
                        <li><a href="">hounking Affiliates</a></li>
                        <li><a href="">hounking Overseas</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Business Ethics</a>
                    <ul>
                        <li><a href="">Code of Ethics</a></li>
                        <li><a href="">Major Activities</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Products/Technology</a>
                    <ul>
                        <li><a href="">Products of houngking</a></li>
                        <li><a href="">hounking Technology</a></li>
                        <li><a href="">Production Process</a></li>
                        <li><a href="">Sales informtion</a></li>
                    </ul>
                </li>
                <li style="padding: 0px;">
                    <a href="">Investor Relations</a>
                    <ul>
                        <li><a href="">IR Activities</a></li>
                        <li><a href="">Stock Information</a></li>
                        <li><a href="">Financial Information</a></li>
                        <li><a href="">IR Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Sustainability</a>
                    <ul>
                        <li><a href="">Suatainability Management System</a></li>
                        <li><a href="">Social Redponsibility</a></li>
                        <li><a href="">Environmental Management</a></li>
                        <li><a href="">Customer</a></li>
                        <li><a href="">Employee</a></li>
                        <li><a href="">Report</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">PR Room</a>
                    <ul>
                        <li><a href="">Newsroom</a></li>
                        <li><a href="">Newsletter</a></li>
                        <li><a href="">houngking SNS</a></li>
                        <li><a href="">PR Archives</a></li>
                        <li><a href="">Download</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Contact Us</a>
                    <ul>
                        <li><a href="">Q&A</a></li>
                        <li><a href="">Search</a></li>
                        <li><a href="">Location</a></li>
                        <li><a href="">Sitemap</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--text-->
<div class="textBox">
    <h2>react+webpack正式环境打包部署</h2>
    <h3>1,正式环境打包</h3>
    <p>要部署到正式的服务器上，就需要使用production的配置。把客户端代码都使用webpack进行打包成一个完整的文件到dist目录下。然后在服务器启动之后访问的就是dist目录下的文件。</p>
    <p>直接用npm run build打包出的dist里的js资源文件非常大，每次更新代码时让用户重新加载这么大的源码，整个网络速度就会被拖的非常慢。但其实里面有非常多的东西是不需要更新的，比如说react、react-router、Mobx这些源码都是第三方的包，没必要每次我们业务代码更新都去重新加载这部分资源。所以需要把这部分代码分开打包。如果做呢？</p>
    <p>打开webpack.config.client.js，在不是dev的情况下做一些另外的配置，让打包的过程不一样。</p>
    <pre style="height: 300px;">// webpack.config.client.js
    ...
    if(isDev){
        ...
    }else {
      config.entry = {
        app: path.join(__dirname,'../client/app.js'),
        vendor: [
          'react',
          'react-dom',
          'react-router-dom',
          'mobx',
          'mobx-react',
          'axios',
          'query-string',
          'dateformat',
          'marked'
        ]
      }; //第三方的包都放到vendor里，打包成一个vendor.js,这样的话就可以在app entry里面更新之后，vendor里的内容是不更新的，每次都可以用浏览器缓存来使用。
      //在有多个entry的时候使用chunkhash，为每个文件生成的hash码是这个文件内容的hash码，而不是打包完成之后所有内容的hash码。以此来保证app和vendor的hash码是不一样的。
      config.output.filename = '[name].[chunkhash].js';
      config.plugins.push(
        new webpack.optimize.UglifyJsPlugin(),  //压缩js源码，把一些变量名之类的变成字符，整个js内容变得更小。
        new webpack.optimize.CommonsChunkPlugin({
          name: 'vendor'
        }), //指定name为vendor，这样才会把app里引用到vendor里的那些包不再重新打包到app entry的js里，而是单独在vendor里去打包。
        //还要注意一个问题，webpack会自动生成一些代码，这些代码每次打包时都会不一样，就算业务代码没有任何更改去打包它，也会产生一些不一样的东西。
        //如果不针对此做配置，会直接打包到vendor里，导致vendor每次都会变换。所以再声明一下，声明一个非entry里声明过的一个节点名，就会自动把内容打包到声明的这个名字里（这里我们声明的名字叫manifest）。
        new webpack.optimize.CommonsChunkPlugin({
          name: 'manifest',
          minChunks: Infinity  //无线压缩包的大小。因为这部分内容虽说非常重要，但代码形式是比较固定的，可以进行无线压缩。
        })
      )
    }</pre>
    <p>这样就能保证我们在更新app js里东西的时候，vendor不会更新。这样能让js尽可能地在浏览器里更长时间的缓存来减少服务器流量的压力，也加快用户加载的速度。</p>
    <p>这里还可以继续优化，关于继续优化的内容可以在webpack网站查看学习。</p>
    <h3>2,部署到CDN</h3>
    <p>打包过程中把需要的静态资源尽可能优化到极致后，在放到线上时，我们希望把静态资源内容扔到一个单独处理静态文件资源请求的地方，即CDN上，在此使用的是七牛cdn。放到cdn的一个好处是，它的网络请求速度比我们的服务器可能快很多，它都是长缓存的资源，且有很多节点，不会一个节点崩掉之后就访问不到内容。</p>


    <h3>3,总结&进阶学习</h3>
    <h4>HTTP:</h4>
    <p>需要知道，浏览器输入一个url之后到底做了什么事情，才能够显示出需要给用户看到的内容。发送的请求到服务器端是什么样子的，服务器根据什么来判断需要返回什么样的内容，返回内容之后又有一个http的response，这个response里面包含了哪些东西，里面的headers又有什么用，能够帮我们带来什么好处。</p>
    <p>http协议很多的内容是涉及到前端优化的方面，理解好http协议才能更好地解决问题。</p>
    <h4>后端编程的基本概念:</h4>
    <p>比如说多页应用和单页应用有什么区别，多页应用为什么可以在后端生成HTML内容以及如何生成的，模板引擎的渲染又是怎么样的概念。这些东西能很熟练的掌握之后，方便协助整个团队搭建项目，作为一个前端架构师，需要跟后端团队考虑讨论项目如何进行架构，是用后端渲染还是前端渲染，接口如何设计、url如何设计。</p>
    <h4>各种工具:</h4>
    <h5>npm</h5>
    <h5>git</h5>
    <h5>webpack</h5>
    <p>是目前前端工具界的老大。可以处理非常多的东西。</p>
    <h5>类库和框架:</h5>
    <p>axios、loadsh等工具库。尽可能多地去了解这些工具库。</p>
    <h4>nodejs:</h4>
    <h5>前端工作流搭建:</h5>
    <p>在现在的前端项目里比重也非常大，因为搭建工作流的时候很多东西都是在nodejs里的，很多项目其实都是nodejs的项目，因为会使用npm init来初始化项目，然后会安装很多npm 的包，整个开发流程就跟开发nodejs项目是一模一样的。很多工具，像webpack、gulp、grunt，都是跑在nodejs的执行环境里的。所以有个nodejs的基础是非常重要的。</p>
    <h5>接口代理:</h5>
    <p>在本地开发前端项目的时候，本地是根本不会起后台的服务，那数据从哪里来呢？这时候可以通过nodejs的proxy去完成一个接口代理，代理到开发后台服务同事的机器上去访问他那边的服务，这样可以进行非常方便的联调。同时帮我们省去了在本地起一个后台服务的繁杂流程。</p>
    <h5>服务端渲染:</h5>
    <p>现在越来越多项目用webapp形式进行开发之后，SEO和首屏加载体验这些问题被更多关注。像react和vue都提供了服务端渲染的功能来解决这个问题。</p>


    <br/>
    <h5>参考文档:</h5>

</div>

</body>
</html>