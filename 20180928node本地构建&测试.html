<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>node本地构建&测试|sumerzhou's blog</title>
    <link href="myblog.css" rel="stylesheet" type="text/css">
    <script src="myblog.js" type="text/javascript"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        .textBox{
            width: 980px;
            border-radius: 20px;
            position: relative;
            padding: 10px;
            top: 105px;
            line-height: 2em;
        }
        .textBox h2{
            margin-top: 10px;
            text-indent: 2em;
            text-shadow: 2px 2px 1px dodgerblue;
        }
        .textBox h3{
            margin-top: 10px;
            border-bottom:1px solid lightblue;
            box-shadow: 2px 2px 1px black;
        }
        .textBox h4{
            text-shadow: 1px 1px 2px #4F68B0;
        }
        .textBox p{
            text-indent: 2em;
        }
        .textBox li{
            text-indent: 2em;
            list-style: none;
        }
        .textBox pre{
            display: block;
            width: 850px;
            border-left: 1px solid black;
            border-right: 1px solid black;
            box-shadow: 4px 3px 2px black;
            padding-left: 30px;
            position: relative;
            left: -30px;
            font-family: '仿宋';
            background-color: rgb(40,44,52);
            line-height: 1.5;
            font-size: 15px;
            color:white;
            overflow-y: auto;
        }
        .highlight{
            background-color: rgb(255,243,212);
        }
    </style>
</head>
<body>
<!--header-->
<div class="headerbox">
    <div class="headertop">
        <div class="hdtopbut">
            <a href="http://blog.hungking.cc/" target="_blank"><img src="imgs/sns_blog_off.png"></a>
            <a href="https://www.facebook.com/HoungkingHsi" target="_blank"><img src="imgs/sns_facebook_off.png"></a>
            <a href="http://globalblog.hungking.cc/" target="_blank"><img src="imgs/sns_gBlog_off.png"></a>
            <a href="http://www.linkedin.com/imisslovelove" target="_blank"><img src="imgs/sns_in_off.png"></a>
            <a href="http://www.youtube.com/imisslovelove" target="_blank"><img src="imgs/sns_youTube_off.png"></a>
            <a href="http://www.instagram.com/imisslovelove" target="_blank"><img src="imgs/sns_instagram_off.png"></a>
            <a href="http://story.kakao.com/ch/imisslovelove" target="_blank" style="background: transparent none;"><img src="imgs/sns_kakao_off.png"></a>
            <div class="hdtopbutR">
                <a href="construction.html" style="background-position-x:85px ;">Contact Me</a>
                <a href="construction.html">AboutSite</a>
                <span onclick="ifshow(0)">Language<img src="imgs/btn_globalSite_open.gif"></span>
                <ul id="lag">
                    <li>KOREAN</li><li>CHINESE</li><li>JAPANESE</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="headerbotm">
        <a class="logohome" href="http://www.hungking.cc/company"><img src="imgs/blog.png"></a>
        <ul id="hdbotmUl">
            <li>
                <a href="company.html">WEB前端</a>
                <ul class="ultext1">
                    <li>
                        <a href="">HTML</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Corporate Overview</a></li>
                                <li><a href="">Vision of houngking</a></li>
                                <li><a href="">History of houngking</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">CSS/CSS3</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Brand Story</a></li>
                                <li><a>CI</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">JavaScript</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Greetings</a></li>
                                <li><a>CEO's Message</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Ajax</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>hougking Affiliates</a></li>
                                <li><a>Steel</a></li>
                                <li><a>E&C</a></li>
                                <li><a>Trade</a></li>
                                <li><a>ICT</a></li>
                                <li><a>Energy</a></li>
                                <li><a>Material-Chemistry</a></li>
                                <li><a>Support</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">jQuery</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Global</a></li>
                                <li><a>Asia</a></li>
                                <li><a>America</a></li>
                                <li><a>Europe&Africa</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Business Ethics</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Code of Ethics</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">CEO Message</a></li>
                                <li><a href="">Ethics Charter</a></li>
                                <li><a href="">Practice Guidelines</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Major Activities</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Operation of the Ethical Management System</a></li>
                                <li><a href="">Education on Corporate Ethics</a></li>
                                <li><a href="">Unethical Act Prevention System</a></li>
                                <li><a href="">External Activities and Results</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Products/Technology</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Products of hounking</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Hot Rolled Steel</a></li>
                                <li><a href="">Steel Plate</a></li>
                                <li><a href="">Winter Day</a></li>
                                <li><a href="">Gold Rolled Steel</a></li>
                                <li><a href="">Galvanized Steel</a></li>
                                <li><a href="">Electrical Galvanized</a></li>
                                <li><a href="">Electrical Steel</a></li>
                                <li><a href="">Automotive materials</a></li>
                                <li><a href="">Stainless Steel</a></li>
                                <li><a href="">Titanium Product</a></li>
                                <li><a href="">Magnesium Product</a></li>
                                <li><a href="">Aluminum-plated products</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">houngking Technology</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">FINEX Technology</a></li>
                                <li><a href="">Strip Casting</a></li>
                                <li><a href="">Endless Hot Rolling Technology</a></li>
                                <li><a href="">Operation Technology</a></li>
                                <li><a href="">CEM Technology</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Production Process</a>
                    </li>
                    <li>
                        <a href="">Sales information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">e-Sales</a></li>
                                <li><a href="">e-Procurement</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Investor Relations</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">IR Activeties</a>
                    </li>
                    <li>
                        <a href="">Stock Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Stock Price</a></li>
                                <li><a href="">Price Comparision</a></li>
                                <li><a href="">ADR</a></li>
                                <li><a href="">houngking Stock Exchange</a></li>
                                <li><a href="">Economic Trend</a></li>
                                <li><a href="">Shareholders Demographics</a></li>
                                <li><a href="">Dividend</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Financial Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Income Statement</a></li>
                                <li><a href="">Credit Rating</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">IR Archive</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Audit Report</a></li>
                                <li><a href="">Form 20-F</a></li>
                                <li><a href="">Annual Report</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Sustainability</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Sustainability Management System</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Management System</a></li>
                                <li><a href="">houngking Subsidiaries CSR Assessment</a></li>
                                <li><a href="">Risk Management</a></li>
                                <li><a href="">Stakeholder</a></li>
                                <li><a href="">Relevant Institutes Activities</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Social Responsibility </a>
                    </li>
                    <li>
                        <a href="">Environmental Management </a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Family's Environmental Management</a></li>
                                <li><a href="">Environmental Management</a></li>
                                <li><a href="">Climate change /Energy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Customer</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Marketing strategy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Employee</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Employee Health / Safety</a></li>
                                <li><a href="">Organizational Culture</a></li>
                                <li><a href="">HR system</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Report</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Report</a></li>
                                <li><a href="">Carbon Report</a></li>
                                <li><a href="">Conflict Minerals Disclosure</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">PR Room</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">News room</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">News letter</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">houngking SNS</a>
                    </li>
                    <li>
                        <a href="">PR Archives</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Digital Brochure</a></li>
                                <li><a href="">TV Cormmercials</a></li>
                                <li><a href="">Screen Saver</a></li>
                                <li><a href="">PR Movies</a></li>
                                <li><a href="">Printed Advertisement</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Download</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Company</a></li>
                                <li><a href="">Products/Technology</a></li>
                                <li><a href="">Investor Relations</a></li>
                                <li><a href="">Sustainability</a></li>
                                <li><a href="">PR Room</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <img src="imgs/btn_gnb.png" class="imgbtn" id="imgbtn" onclick="ifshow(1)">
        <img src="imgs/btn_search.png" class="imgbtn2" onclick="ifshow(2)">
        <div class="hdmenu" id="hdmenu">
            <a href="">Open submenu</a>
            <ul class="menutxt1">
                <li>
                    <a href="">Company</a>
                    <ul>
                        <li><a href="">Corporate Overview</a></li>
                        <li><a href="">Brand</a></li>
                        <li><a href="">CEO</a></li>
                        <li><a href="">hounking Affiliates</a></li>
                        <li><a href="">hounking Overseas</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Business Ethics</a>
                    <ul>
                        <li><a href="">Code of Ethics</a></li>
                        <li><a href="">Major Activities</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Products/Technology</a>
                    <ul>
                        <li><a href="">Products of houngking</a></li>
                        <li><a href="">hounking Technology</a></li>
                        <li><a href="">Production Process</a></li>
                        <li><a href="">Sales informtion</a></li>
                    </ul>
                </li>
                <li style="padding: 0px;">
                    <a href="">Investor Relations</a>
                    <ul>
                        <li><a href="">IR Activities</a></li>
                        <li><a href="">Stock Information</a></li>
                        <li><a href="">Financial Information</a></li>
                        <li><a href="">IR Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Sustainability</a>
                    <ul>
                        <li><a href="">Suatainability Management System</a></li>
                        <li><a href="">Social Redponsibility</a></li>
                        <li><a href="">Environmental Management</a></li>
                        <li><a href="">Customer</a></li>
                        <li><a href="">Employee</a></li>
                        <li><a href="">Report</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">PR Room</a>
                    <ul>
                        <li><a href="">Newsroom</a></li>
                        <li><a href="">Newsletter</a></li>
                        <li><a href="">houngking SNS</a></li>
                        <li><a href="">PR Archives</a></li>
                        <li><a href="">Download</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Contact Us</a>
                    <ul>
                        <li><a href="">Q&A</a></li>
                        <li><a href="">Search</a></li>
                        <li><a href="">Location</a></li>
                        <li><a href="">Sitemap</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--text-->
<div class="textBox">
    <h2>node本地构建&测试 </h2>
    <h3>1,静态资源服务器</h3>
    <p>介绍一个模块工具,supervisor,全局安装后，可以监听nodejs后端代码修改的状态，不用一直重启服务器。</p>
    <pre>npm i -g supervisor</pre>
    <p>然后不用node来启动服务器，而用supervisor模块来启动：</p>
    <pre>// 例：
    supervisor app.js </pre>
    <h4>缓存：</h4>
    <h5>缓存header：</h5>
    <p>· 判断本地有没有效：Expires(绝对时间),Cache-Control（相对时间）</p>
    <p>· 与服务器校验时候用：If-Modified-Since/Last-Modified</p>
    <p>· 一般为哈希算法，文件改变，相应的值也会变：If-None-Match/ETag</p>
    <h4>cli工具（命令行工具）：</h4>
    <p>读取命令行上的参数，可以用commander、yargs等工具。</p>
    <p>当成cli工具，只需要在package.json中加一个“bin”配置就行了。当我们全局安装npm包的时候，会自动往系统的path里面注册几个命令。</p>
    <h4>启动服务器后自动打开网页：</h4>
    <p>用exec调用系统的默认命令，这也是nodejs內建的“child_process”包里的。</p>

    <h3>2,本地构建</h3>
    <p>处理代码压缩、合并、浏览器兼容（自动加上浏览器前缀）、新特性使用（es6,es7,sass等）等的自动化构建流程。</p>
    <p>由此需求应运而生的工具有：gulp,babel,webpack等</p>
    <h4>gulp:</h4>
    <p>基础API:</p>
    <h5>1),gulp.src(globs,option),获取到我们想处理的文件</h5>
    <p>glob:</p>
    <p>· *匹配任意个字符</p>
    <p>· ？匹配一个字符</p>
    <p>· […]匹配范围内字符</p>
    <p>· !(pattern1|pattern2)匹配取反</p>
    <p>· ?(pattern1|pattern2)匹配0或1个</p>
    <p>· +(pattern1|pattern2)匹配1或多个</p>
    <p>· *(a|b|c)匹配任意个</p>
    <p>· @(pattern|pat*|pat?erN)匹配特定的一个</p>
    <p>· **任意层级匹配</p>
    <h5>2),gulp.dest(path,options),把数据重新输出到别的地方。</h5>
    <h5>3),gulp.task(name,deps,fuc)</h5>
    <p>默认的，task将以最大的并发数执行，也就是说，gulp会一次性运行所有的task并且不做任何等待。</p>
    <h5>4),gulp.watch(glob,options,tasks)或gulp.watch(glob,options,cb)</h5>
    <p>监视文件，并且可以在文件发生改动时做一些事情。它总会返回一个eventEmitter来发射change事件。</p>
    <h5>gulp插件工具：</h5>
    <p>gulp-autoprefixer,自动在css、less等加浏览器兼容前缀。</p>
    <p>gulp-clean-css压缩css。</p>
    <h4>babel: </h4>
    <p>babel是一个javascript的编译器，可以解决es版本语法的兼容、nodejs和es6模块应用方式、react的jsx语法等问题。</p>
    <p>babel构建完后，依赖并没有构建掉（require的包）。babel做的是构建，但出了构建还需要打包。babel构建的初步结果，在没打包之前，在服务器端是可以跑的，打了包之后在浏览器端也能跑了。这就需要用到同构和打包的技术。</p>
    <h5>plugins:</h5>
    <p>babel的plugins专门处理它的presets里没有的东西。</p>
    <h4>webpack:</h4>
    <p>之前的打包工具有很多，包括一度非常流行的browserify，以及后来出现的Rollup。Rollup的一些新功能webpack也支持了。webpack的生态是比较健全的。</p>
    <p>webpack配置文件有一个module配置的地方用来配置模块规则。模块规则来配置loader、解析器等选项。loader是用来帮我们解析各种各样的文件类型，就像解析less、react等。webpack在没有配置前也不认识less、react这些，看到react也需要babel处理，看到less也需要相应的模块处理，它管所有这样的模块叫做loader。不同的loader处理不同的文件，帮我们做一些转换。</p>
    <p>babel构建后，再用配置好的webpack构建出的内容，比原先单用babel时多了，它把require的react等包都打包进来了。</p>

    <h4>nodejs常用工具:</h4>
    <p>del包，用来删除文件或文件夹。</p>
    <h3>3,单元测试</h3>
    <p>nodejs最大的优势，在本地构建方面，是用javascript作为语言，对前端开发是非常友好的。nodejs还帮前端解决了另外一个新兴问题：测试。</p>
    <p>随着前端越来越庞大和复杂，前端需要像后端一样有系统、工具、流程来做保证，才能让代码变得健壮。所以前端也需要有专门的测试。</p>
    <h4>assert-断言:</h4>
    <p>nodejs原生的，帮我们作断言，比较语义化。</p>
    <p>业界比较流行的断言库：should，expect，assert（和nodejs官方原生的assert几乎一样，但比官方的方法更丰富一些）</p>
    <p>断言上主要有两个风格：BDD行为驱动开发,TDD测试驱动开发。</p>
    <p>首先需要安装chai :</p>
    <pre> npm install chai </pre>
    <p>然后在需要的文件中引入使用：</p>
    <pre>// example：
    const { should, expect, assert } = require('chai'); </pre>
    <h4>mocha:</h4>
    <p>mocha是JavaScript的一种单元测试框架，既可以在浏览器环境下运行，也可以在Node.js环境下运行。</p>
    <p>使用mocha，我们就只需要专注于编写单元测试本身，然后，让mocha去自动运行所有的测试，并给出测试结果。</p>
    <p>使用mocha：它需要一个断言库，里面帮助跑各种各样的断言。Mocha自己是不包含任何断言的。</p>
    <p>单元测试：具体测试一个单元块。</p>
    <h4>测试代码覆盖率:</h4>
    <p>istanbul:用于测试代码覆盖率的工具。</p>
    <h4>持续集成:</h4>
    <p>持续集成是一种软件开发流程。</p>
    <h5>特性：</h5>
    <p>频繁地将代码集成到主干;</p>
    <p>每次集成都通过自动化的构建来验证;</p>
    <h5>好处：</h5>
    <p>尽早发现错误;</p>
    <p>防止分支大幅度偏离主干;</p>
    <h4>性能测试：</h4>
    <p>benchmark.js ,可以查看去除额外影响性能因素之后的真正执行情况。</p>
    <h3>4, UI 测试常用工具</h3>
    <p>以上的benchmark、持续集成、覆盖率等工具和方法，统一归为一类--API测试。此外还有一类，UI组件。</p>
    <p>如何自动化、高效地进行UI组件的测试？这里介绍react相关的UI测试技巧。</p>
    <h4>jest:</h4>
    <p>react官方提供的UI测试相关工具：jest。jest对于API组件测试也是可以的。</p>
    <p>用jest的特征是，它把Mocha、chai断言库、istanbul代码覆盖率工具等都集成了，不用花时间再去配置。</p>
    <h5>DOM测试:</h5>
    <p>如果想要断言和操纵渲染的组件，可以使用Enzyme或react的testUtils。</p>
    <h5>sinon库:</h5>
    <p>sinon库模拟一些函数的调用情况。</p>
    <h4>webdriver:</h4>
    <p>通过程序来驱动浏览器，让我们的一些输入、点击行为等都可以通过程序来模拟，做整个网页的UI测试。</p>
    <p>selenium-webdriver是一个自动的浏览器库。经常用来测试web应用。</p>
    <p>webdriver实际上是一个通用的协议，把各种各样的API都定义好了，我们可以通过API来模拟浏览器的行为。selenium-webdriver这个包就是用 nodejs对这个协议做了实现。</p>


    <br/>
    <h5>参考文档:</h5>

</div>

</body>
</html>