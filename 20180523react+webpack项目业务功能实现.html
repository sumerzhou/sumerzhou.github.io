<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>react+webpack项目业务功能实现|sumerzhou's blog</title>
    <link href="myblog.css" rel="stylesheet" type="text/css">
    <script src="myblog.js" type="text/javascript"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        .textBox{
            width: 980px;
            border-radius: 20px;
            position: relative;
            padding: 10px;
            top: 105px;
            line-height: 2em;
        }
        .textBox h2{
            margin-top: 10px;
            text-indent: 2em;
            text-shadow: 2px 2px 1px dodgerblue;
        }
        .textBox h3{
            margin-top: 10px;
            border-bottom:1px solid lightblue;
            box-shadow: 2px 2px 1px black;
        }
        .textBox h4{
            text-shadow: 1px 1px 2px #4F68B0;
        }
        .textBox p{
            text-indent: 2em;
        }
        .textBox li{
            text-indent: 2em;
            list-style: none;
        }
        .textBox pre{
            display: block;
            width: 850px;
            border-left: 1px solid black;
            border-right: 1px solid black;
            box-shadow: 4px 3px 2px black;
            padding-left: 30px;
            position: relative;
            left: -30px;
            font-family: '仿宋';
            background-color: rgb(40,44,52);
            line-height: 1.5;
            font-size: 15px;
            color:white;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<!--header-->
<div class="headerbox">
    <div class="headertop">
        <div class="hdtopbut">
            <a href="http://blog.hungking.cc/" target="_blank"><img src="imgs/sns_blog_off.png"></a>
            <a href="https://www.facebook.com/HoungkingHsi" target="_blank"><img src="imgs/sns_facebook_off.png"></a>
            <a href="http://globalblog.hungking.cc/" target="_blank"><img src="imgs/sns_gBlog_off.png"></a>
            <a href="http://www.linkedin.com/imisslovelove" target="_blank"><img src="imgs/sns_in_off.png"></a>
            <a href="http://www.youtube.com/imisslovelove" target="_blank"><img src="imgs/sns_youTube_off.png"></a>
            <a href="http://www.instagram.com/imisslovelove" target="_blank"><img src="imgs/sns_instagram_off.png"></a>
            <a href="http://story.kakao.com/ch/imisslovelove" target="_blank" style="background: transparent none;"><img src="imgs/sns_kakao_off.png"></a>
            <div class="hdtopbutR">
                <a href="construction.html" style="background-position-x:85px ;">Contact Me</a>
                <a href="construction.html">AboutSite</a>
                <span onclick="ifshow(0)">Language<img src="imgs/btn_globalSite_open.gif"></span>
                <ul id="lag">
                    <li>KOREAN</li><li>CHINESE</li><li>JAPANESE</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="headerbotm">
        <a class="logohome" href="http://www.hungking.cc/company"><img src="imgs/blog.png"></a>
        <ul id="hdbotmUl">
            <li>
                <a href="company.html">WEB前端</a>
                <ul class="ultext1">
                    <li>
                        <a href="">HTML</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Corporate Overview</a></li>
                                <li><a href="">Vision of houngking</a></li>
                                <li><a href="">History of houngking</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">CSS/CSS3</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Brand Story</a></li>
                                <li><a>CI</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">JavaScript</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Greetings</a></li>
                                <li><a>CEO's Message</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Ajax</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>hougking Affiliates</a></li>
                                <li><a>Steel</a></li>
                                <li><a>E&C</a></li>
                                <li><a>Trade</a></li>
                                <li><a>ICT</a></li>
                                <li><a>Energy</a></li>
                                <li><a>Material-Chemistry</a></li>
                                <li><a>Support</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">jQuery</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Global</a></li>
                                <li><a>Asia</a></li>
                                <li><a>America</a></li>
                                <li><a>Europe&Africa</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Business Ethics</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Code of Ethics</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">CEO Message</a></li>
                                <li><a href="">Ethics Charter</a></li>
                                <li><a href="">Practice Guidelines</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Major Activities</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Operation of the Ethical Management System</a></li>
                                <li><a href="">Education on Corporate Ethics</a></li>
                                <li><a href="">Unethical Act Prevention System</a></li>
                                <li><a href="">External Activities and Results</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Products/Technology</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Products of hounking</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Hot Rolled Steel</a></li>
                                <li><a href="">Steel Plate</a></li>
                                <li><a href="">Winter Day</a></li>
                                <li><a href="">Gold Rolled Steel</a></li>
                                <li><a href="">Galvanized Steel</a></li>
                                <li><a href="">Electrical Galvanized</a></li>
                                <li><a href="">Electrical Steel</a></li>
                                <li><a href="">Automotive materials</a></li>
                                <li><a href="">Stainless Steel</a></li>
                                <li><a href="">Titanium Product</a></li>
                                <li><a href="">Magnesium Product</a></li>
                                <li><a href="">Aluminum-plated products</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">houngking Technology</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">FINEX Technology</a></li>
                                <li><a href="">Strip Casting</a></li>
                                <li><a href="">Endless Hot Rolling Technology</a></li>
                                <li><a href="">Operation Technology</a></li>
                                <li><a href="">CEM Technology</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Production Process</a>
                    </li>
                    <li>
                        <a href="">Sales information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">e-Sales</a></li>
                                <li><a href="">e-Procurement</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Investor Relations</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">IR Activeties</a>
                    </li>
                    <li>
                        <a href="">Stock Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Stock Price</a></li>
                                <li><a href="">Price Comparision</a></li>
                                <li><a href="">ADR</a></li>
                                <li><a href="">houngking Stock Exchange</a></li>
                                <li><a href="">Economic Trend</a></li>
                                <li><a href="">Shareholders Demographics</a></li>
                                <li><a href="">Dividend</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Financial Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Income Statement</a></li>
                                <li><a href="">Credit Rating</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">IR Archive</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Audit Report</a></li>
                                <li><a href="">Form 20-F</a></li>
                                <li><a href="">Annual Report</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Sustainability</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Sustainability Management System</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Management System</a></li>
                                <li><a href="">houngking Subsidiaries CSR Assessment</a></li>
                                <li><a href="">Risk Management</a></li>
                                <li><a href="">Stakeholder</a></li>
                                <li><a href="">Relevant Institutes Activities</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Social Responsibility </a>
                    </li>
                    <li>
                        <a href="">Environmental Management </a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Family's Environmental Management</a></li>
                                <li><a href="">Environmental Management</a></li>
                                <li><a href="">Climate change /Energy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Customer</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Marketing strategy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Employee</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Employee Health / Safety</a></li>
                                <li><a href="">Organizational Culture</a></li>
                                <li><a href="">HR system</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Report</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Report</a></li>
                                <li><a href="">Carbon Report</a></li>
                                <li><a href="">Conflict Minerals Disclosure</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">PR Room</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">News room</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">News letter</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">houngking SNS</a>
                    </li>
                    <li>
                        <a href="">PR Archives</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Digital Brochure</a></li>
                                <li><a href="">TV Cormmercials</a></li>
                                <li><a href="">Screen Saver</a></li>
                                <li><a href="">PR Movies</a></li>
                                <li><a href="">Printed Advertisement</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Download</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Company</a></li>
                                <li><a href="">Products/Technology</a></li>
                                <li><a href="">Investor Relations</a></li>
                                <li><a href="">Sustainability</a></li>
                                <li><a href="">PR Room</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <img src="imgs/btn_gnb.png" class="imgbtn" id="imgbtn" onclick="ifshow(1)">
        <img src="imgs/btn_search.png" class="imgbtn2" onclick="ifshow(2)">
        <div class="hdmenu" id="hdmenu">
            <a href="">Open submenu</a>
            <ul class="menutxt1">
                <li>
                    <a href="">Company</a>
                    <ul>
                        <li><a href="">Corporate Overview</a></li>
                        <li><a href="">Brand</a></li>
                        <li><a href="">CEO</a></li>
                        <li><a href="">hounking Affiliates</a></li>
                        <li><a href="">hounking Overseas</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Business Ethics</a>
                    <ul>
                        <li><a href="">Code of Ethics</a></li>
                        <li><a href="">Major Activities</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Products/Technology</a>
                    <ul>
                        <li><a href="">Products of houngking</a></li>
                        <li><a href="">hounking Technology</a></li>
                        <li><a href="">Production Process</a></li>
                        <li><a href="">Sales informtion</a></li>
                    </ul>
                </li>
                <li style="padding: 0px;">
                    <a href="">Investor Relations</a>
                    <ul>
                        <li><a href="">IR Activities</a></li>
                        <li><a href="">Stock Information</a></li>
                        <li><a href="">Financial Information</a></li>
                        <li><a href="">IR Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Sustainability</a>
                    <ul>
                        <li><a href="">Suatainability Management System</a></li>
                        <li><a href="">Social Redponsibility</a></li>
                        <li><a href="">Environmental Management</a></li>
                        <li><a href="">Customer</a></li>
                        <li><a href="">Employee</a></li>
                        <li><a href="">Report</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">PR Room</a>
                    <ul>
                        <li><a href="">Newsroom</a></li>
                        <li><a href="">Newsletter</a></li>
                        <li><a href="">houngking SNS</a></li>
                        <li><a href="">PR Archives</a></li>
                        <li><a href="">Download</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Contact Us</a>
                    <ul>
                        <li><a href="">Q&A</a></li>
                        <li><a href="">Search</a></li>
                        <li><a href="">Location</a></li>
                        <li><a href="">Sitemap</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--text-->
<div class="textBox">
    <h2>react+webpack 项目业务功能实现</h2>
    <h3>1,React16介绍</h3>
    <p>React16更小了，react+react-dom在gzipped之后小了10k左右，从四十几k变成三十多k。其中主要是因为在react的生产环境版本，它使用的是rollup进行打包，rollup打包完的是一个小到极致的代码包，在使用webpack、browserify等工具去引用react的时候，引用的是一个打包完的最小化的包，这个包使用rollup发布，所以整个压缩比例非常好。其次它整个代码都用fiber重写了。fiber是现在js界比较流行的一种编程理念，它给react带来非常多的新功能。最后它更新了一堆非常有用的功能，这些功能是以前版本中被希望去实现的。</p>
    <h4>新特性:</h4>
    <h5>error boundary:</h5>
    <p>它是帮助捕获react整个渲染过程中出现的错误，在正式环境中如果有错误出现，就可以显示一个提醒并且捕获到错误的内容，通过某些方式可以记录在一个地方。这样可以为以后排错和更新代码提供参考。</p>
    <h5>New render return types:</h5>
    <p>现在的react16可以支持在render function里面返回一个数组和string。在以往的版本中，render function必须要返回有个根节点（div）的内容。</p>
    <h5>Portals:</h5>
    <p>Portals 提供了一种很好的将子节点渲染到父组件以外的 DOM 节点的方式。</p>
    <h5>Better server-side rendering:</h5>
    <p>react16更新了一些服务端渲染的功能。它提升了渲染速度，且支持streaming。</p>
    <p>streaming是说在一个请求过来时服务端先返回一部分不需要等待的内容，比如HTML头和一些固定信息之类，然后剩下要等待的过程比如去数据库读取数据，等数据读取完成渲染完成功后再把这部分内容返回，最后再把结尾部分发送过去。这样以流的方式发送给浏览器端，可以让用户先看到一部分内容，会感觉网站非常快。streaming也有局限性，最终渲染出的HTML内容需要按照这种顺序的方式渲染，如果没有办法按照这种方式渲染得到，就无法使用streamimg的方式。</p>
    <p>react16更多是在整体方面有了速度的提升。比如，在服务端渲染内容发送到客户端之后，因为react还要在客户端再渲染一次，react16提供了一个新API专门在有服务端渲染的情况下去渲染客户端代码，就是ReactDOM.hydrate。</p>
    <h3>2,Material-ui安装使用</h3>
    <p><a href="https://material-ui.com/" target="_blank">Material-ui</a>是个很好用的组件库，是react中最著名的组件库之一。它的所有组件遵循Google的material design。</p>
    <p>我们使用的是v1正式版本。它的实现方式跟之前很多ui库不一样，它有很多自己设计的一套理念，东西非常多，功能非常强大，组件非常多。但它的浏览器兼容性并不高，IE要在10以后的版本才会支持。</p>
    <p>在正式使用这个ui组件库之前，需要进行一些设置，也是关于服务端渲染的。在官网的guides-server rendering里有说明在使用组件库时需要配置一定的服务端渲染的东西，会涉及到样式上的内容。因为这个组件库的样式实现是它自己实现了一个工具叫jss，也就是css in js，在用组件库写css时全部在js中写，没有css文件sass文件less文件。最终写的css会以一个样式表的形式从js插入到HTML的head里某一个style标签下，以此来实现css。它的css有非常好的动态性，以及ClassName是实时生成的、动态的、可压缩的。</p>
    <h4>项目使用</h4>
    <p>安装:</p>
    <pre>
    npm i @material-ui/core @material-ui/icons -S </pre>
    <p>先在客户端配置。material-ui是可以配置主题的，主题颜色可以在js中设置。打开app.js :</p>
    <pre>// app.js
    ...
    import { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'   //这两个方法用来创建主题
    import { lightBlue, pink } from '@material-ui/core/colors'   //引入主题颜色
    const theme = createMuiTheme({   //创建一个主题
      palette: {
        primary: lightBlue,
        accent: pink,
        type: 'light',
      },
    });
    ...
          &lt;MuiThemeProvider theme={theme}&gt;  //把theme挂载到整个app上。然后就可以在应用中去使用material-ui了。
            &lt;Component /&gt;
          &lt;/MuiThemeProvider&gt;
    ...</pre>
    <p>然后去topic-list/index.jsx中使用。在react中，使用每一个组件都去单独import，这样能控制整个app在使用组件上面按需加载，我们装了整个组件库并不需要把所有组件一次性打包到js里。</p>
    <pre>// topic-list/index.jsx
    ...
    import Button from '@material-ui/core/Button'
    ...
        render() {
            return (
              ...
                &lt;Button variant="raised" color="primary"&gt;this is a button&lt;/Button&gt;
                &lt;input type="text" onChange={this.changeName} /&gt;
              ...</pre>
    <p>然后npm run dev:client和npm run dev:server看一下效果。</p>
    <p>检查网页element，会发现css在head中出现，是material-ui的一些东西。查看网页源代码，里面却并没有css。这导致的结果是，页面一开始加载过来的时候并没有样式，要等js运行了把样式插入到head之后才会显示想要的样式。所以要去在服务端渲染时做一些配置，让其在服务端返回的内容里就有样式。</p>
    <p>首先去安装几个工具:</p>
    <pre>
    npm i react-jss -S
    //react-jss是用jss去连接react的一个工具</pre>
    <p>官网文档里服务端渲染文档所演示的代码片段因为跟我们项目架构不一样，所以不具有太大参考性。但可以参照它的整体思路去实现我们自己的内容。</p>
    <p>整个基本流程：通过server-render.js里去创建sheetsRegistry和theme,然后传给createApp去通过MuiThemeProvider、JssProvider组件把整个app构建出来，之后再renderToString，然后再通过sheetsRegistry对象拿到最终的css代码，接着通过ejs的模板把内容渲染进去。</p>
    <p>打开server-entry.js :</p>
    <pre>// server-entry.js
    ...
    import { JssProvider } from 'react-jss'
    import { MuiThemeProvider } from '@material-ui/core/styles'
    ...
    export default (stores, routerContext, sheetsRegistry, generateClassName, theme, url) => (
      ...
          &lt;JssProvider registry={sheetsRegistry} generateClassName={generateClassName}&gt;
            &lt;MuiThemeProvider theme={theme}&gt;
              &lt;App /&gt;
            &lt;/MuiThemeProvider&gt;
          &lt;/JssProvider&gt;
    ...</pre>
    <p>接下去到server-render.js里创建这些东西：</p>
    <pre style="height: 300px;">// server-render.js
    ...
    const SheetsRegistry = require('react-jss').SheetsRegistry; //使用require引入时需要后面加上.SheetsRegistry
    const createMuiTheme = require('@material-ui/core/styles').createMuiTheme;
    const createGenerateClassName = require('@material-ui/core/styles').createGenerateClassName;
    const colors = require('@material-ui/core/colors');
    ...
        const createApp = bundle.default;
        const theme = createMuiTheme({
          palette: {
            primary: colors.lightBlue,
            accent: colors.pink,
            type: 'light',
          },
        });//保持和客户端一致
        const sheetsRegistry = new SheetsRegistry(); //theme、sheetsRegistry每个请求都需要去创建
        const generateClassName = createGenerateClassName();
        ...
        const app = createApp(stores,routerContext,sheetsRegistry,generateClassName,theme,req.url);
        asyncBootstrap(app).then(() => {
          ...
          const html = ejs.render(template,{
            ...
            materialCss:sheetsRegistry.toString()  //把样式放到template里
          });
          ...</pre>
    <p>然后需要去改一下模板server.template.ejs,让它渲染到style标签里去:</p>
    <pre>// server.template.ejs
    ...
    &lt;head&gt;
      ...
      &lt;style id="jss-server-side"&gt;
        &lt;%%- materialCss %&gt;
      &lt;/style&gt;
    &lt;/head&gt;
    ...</pre>
    <p>刷新页面后查看网页源代码，可以看到在style标签下有很多样式，这些样式就是在服务端渲染时候生成的。</p>
    <p>到这里还存在一个小问题，官网文档说到The Client Side的时候我们需要把服务端生产的css去掉。因为在客户端渲染时也会同样生成这段css（在整个节点渲染完后，客户端css才会真正生成），服务端的css和客户端css可能会造成冲突，导致一些问题。官方文档提供了一个去掉服务端css的例子：在客户端组件componentDidMount时候，查找一个css节点，然后删除。参考这部分代码，我们首先要去在style标签上去加一个id。所以我们在ejs模板文件里的style标签上加上“id=‘jss-server-side’”，然后修改app.js：</p>
    <pre style="height: 300px;">// app.js
    ...
    //在客户端时有可能不仅仅是第一次渲染时用到TheApp，或许还会去用到这部分内容，所以每次去新建createApp。
    const createApp = (TheApp) => {
      class Main extends React.Component {
        // Remove the server-side injected CSS.
        componentDidMount() {
          const jssStyles = document.getElementById('jss-server-side');
          if (jssStyles && jssStyles.parentNode) {
            jssStyles.parentNode.removeChild(jssStyles);
          }
        }
        render() {
          return &lt;TheApp /&gt;
        }
      }
      return Main
    };
    const root = document.getElementById('root');
    ...
    render(createApp(App));
    if (module.hot) {
      ...
        render(createApp(NextApp));
      })
    }</pre>
    <p>重新刷新网页，检查元素会看到head标签里服务端渲染的style标签就没有了。</p>
    <h3>3,页面主框架实现</h3>
    <p>实现cnodejs网站功能。</p>
    <p>在views目录下新建一个layout目录，里面放导航栏。在该目录下新建一个app-bar.jsx文件：</p>
    <pre style="height: 300px;">// app-bar.jsx
    import React from 'react'
    // import PropTypes from 'prop-types'
    // import { withStyles } from '@material-ui/core/styles'
    import AppBar from '@material-ui/core/AppBar'
    import Toolbar from '@material-ui/core/Toolbar'
    import Button from '@material-ui/core/Button'
    import Typography from '@material-ui/core/Typography'
    import IconButton from '@material-ui/core/IconButton'
    import HomeIcon from '@material-ui/icons/Home'

    class MainAppBar extends React.Component {
      constructor() {
        super();//super()方法在有申明constructor方法时一定要写，因为是extend自React.Cmponent。
        //如果没有申明constructor方法，super()会默认执行。
        this.onHomeIconClick = this.onHomeIconClick.bind(this);
        this.createButtonClick = this.createButtonClick.bind(this);
        this.loginButtonClick = this.loginButtonClick.bind(this);
      }
      /* eslint-disable */
      onHomeIconClick(){

      }

      createButtonClick(){

      }

      loginButtonClick(){

      }
      /* eslint-enable */

      render() {
        return (
          &lt;div&gt;
            &lt;AppBar position="fixed"&gt;
              &lt;Toolbar&gt;
                &lt;IconButton color="contrast" onClick={this.onHomeIconClick}&gt;
                  &lt;HomeIcon /&gt;
                &lt;/IconButton&gt;
                &lt;Typography type="title" color="inherit"&gt;
                  JNode
                &lt;/Typography&gt;
                &lt;Button variant="raised" color="accent" onClick={this.createButtonClick}&gt;
                  新建话题
                &lt;/Button&gt;
                &lt;Button color="contrast" onClick={this.loginButtonClick}&gt;
                  登录
                &lt;/Button&gt;
              &lt;/Toolbar&gt;
            &lt;/AppBar&gt;
          &lt;/div&gt;
        )
      }
    }
    export default MainAppBar</pre>
    <p>去App.jsx中把app-bar引入:</p>
    <pre>// App.jsx
    import React from 'react'
    import Routes from '../config/router'
    import AppBar from './layout/app-bar'
    export default class App extends React.Component {
      componentDidMount() {
        // do something here
      }
      render() {
        return [
          &lt;AppBar /&gt;,
          &lt;Routes /&gt;,
        ]
      }
    }</pre>
    <p>在验证前，还需小改一个地方。在webpack.config.client.js下面把config.devServer.contentBase注释掉。这个东西没什么用，如果我们使用‘/public/’这种方式在客户端启动webpack devServer去访问的时候，就不需要声明contentBase。</p>
    <p>另外还需要在开发时候加一个配置devtool:#cheap-module-eval-source-map。这是个webpack devtool的一个选项，它能够形成一个source map，让我们在浏览器中调试代码时同时调试我们写的源代码，也就是jsx没有经过编译的代码。这样可以非常快定位错误，而不是编译完成的代码。</p>
    <pre>// webpack.config.client.js
    ...
    if(isDev){
        config.devtool = '#cheap-module-eval-source-map';
    ...</pre>
    <p>服务端渲染已经完成差不多了，后期只需要每次去测试时使用服务端渲染去测试就可以。平时开发时写前端代码，还是以客户端模式开发为主。因为一旦报错，服务端渲染的时候是很难定位到错误的，而在浏览器中打开就很容易定位。</p>
    <p>然后启动服务npm run dev:server和npm run dev:client。server也需要启动，因为需要去代理接口。访问localhost:8888。</p>
    <h4>调整样式:</h4>
    <p>参考Material-ui官网的例子去调整页面样式。</p>
    <p>在app.js中createMuiTheme的时候，我们可以预先定义很多东西，比如fontsize。这是一个很好的主题定义的方案。后续写样式的时候，都用主题定义时的样式的话，如果要改变某一样式，那在主题theme样式里变了，后面所有对应的东西样式也都自动改了。</p>
    <p>theme可通过withStyles方法包含到组件里定义的style，然后就可以用theme里的变量。</p>
    <p>修改app-bar.jsx:</p>
    <pre style="height: 300px;">// app-bar.jsx
    ...
    const styles = {
      root: {
        width: '100%',
      },
      flex: {
        flex: 1,
      },
    };
    class MainAppBar extends React.Component {
        ...
        render() {
            const { classes } = this.props;
            return (
              &lt;div className={classes.root}&gt;
                &lt;AppBar position="fixed"&gt;
                  &lt;Toolbar&gt;
                    ...
                    &lt;Typography type="title" color="inherit" className={classes.flex}&gt;
                      JNode
                    &lt;/Typography&gt;
                    ...
                  &lt;/Toolbar&gt;
                &lt;/AppBar&gt;
              &lt;/div&gt;
            )
        }
    }
    MainAppBar.propTypes = {
      classes: PropTypes.object.isRequired,
    };
    //使用withStyles方法会给组件外面套一层组件，形成css。
    //套完后会给props传一个classes对象，classes里包含了定义的样式。
    export default withStyles(styles)(MainAppBar)</pre>
    <p>再在layout下新建一个文件container.jsx :</p>
    <pre style="height:300px;">// container.jsx
    import React from 'react'
    import PropTypes from 'prop-types'
    import { withStyles } from '@material-ui/core/styles'
    import Paper from '@material-ui/core/Paper'
    const styles = {
      root: {
        margin: 24,
        marginTop: 80,
      },
    };

    const Container = ({ classes, children }) => (
      &lt;Paper elevation={4} className={classes.root}&gt;
        {children}
      &lt;/Paper&gt;
    );

    Container.propTypes = {
      classes: PropTypes.object.isRequired,
      children: PropTypes.oneOfType([
        PropTypes.arrayOf(PropTypes.element),
        PropTypes.element,
      ]),
    };
    export default withStyles(styles)(Container)</pre>
    <p>然后把Container组件引入到topic-list页面：</p>
    <pre>// topic-list/index.jsx
    ...
    import Container from '../layout/container'
    ...
    export default class TopicList extends React.Component {
        ...
      render() {
        return (
          &lt;Container&gt;
            ...
            &lt;span&gt;{this.props.appState.msg}&lt;/span&gt;
          &lt;/Container&gt;
        )
      }
    }
    ...</pre>
    <p>至此，页面的主框架已经好了。</p>
    <h3>4,主页样式实现</h3>
    <p>首先要去完成主页话题列表的tab切换功能以及展示的列表组件。</p>
    <p>列表部分单独写一个组件，因为需要重复循环。在topic-list目录下新建一个list-item.jsx文件。</p>
    <pre style="height: 500px;">// topic-list/list-item.jsx
    import React from 'react'
    import ListItem from '@material-ui/core/ListItem';
    import ListItemAvatar from '@material-ui/core/ListItemAvatar';
    import ListItemText from '@material-ui/core/ListItemText';
    import Avatar from '@material-ui/core/Avatar';
    import PropTypes from 'prop-types'
    import { withStyles } from '@material-ui/core/styles'
    import { topicPrimaryStyle, topicSecondaryStyle } from './style'

    const Primary = ({ classes, topic }) => (
      &lt;div className={classes.root}&gt;
        &lt;span className={classes.tab}&gt;{topic.tab}&lt;/span&gt;
        &lt;span className={classes.title}&gt;{topic.title}&lt;/span&gt;
      &lt;/div&gt;
    );
    const StyledPrimary = withStyles(topicPrimaryStyle)(Primary);
    const Secondary = ({ classes, topic }) => (
      &lt;div className={classes.root}&gt;
        &lt;span className={classes.userName}&gt;{topic.username}&lt;/span&gt;
        &lt;span className={classes.count}&gt;
          &lt;span className={classes.accentColor}&gt;{topic.reply_count}&lt;/span&gt;
          &lt;span&gt;/&lt;/span&gt;
          &lt;span&gt;{topic.visit_count}&lt;/span&gt;
        &lt;/span&gt;
        &lt;span&gt;创建时间:{topic.create_at}&lt;/span&gt;
      &lt;/div&gt;
    );
    const StyledSecondary = withStyles(topicSecondaryStyle)(Secondary);
    Primary.propTypes = {
      topic: PropTypes.object.isRequired,
      classes: PropTypes.object.isRequired,
    };
    Secondary.propTypes = {
      topic: PropTypes.object.isRequired,
      classes: PropTypes.object.isRequired,
    };

    const TopicListItem = ({ onClick, topic }) => (
      &lt;ListItem button onClick={onClick}&gt;
        &lt;ListItemAvatar&gt;
          &lt;Avatar src={topic.image} /&gt;
        &lt;/ListItemAvatar&gt;
        &lt;ListItemText
          primary={&lt;StyledPrimary topic={topic} /&gt;}
          secondary={&lt;StyledSecondary topic={topic} /&gt;}
        /&gt;
      &lt;/ListItem&gt;
    );
    TopicListItem.propTypes = {
      onClick: PropTypes.func.isRequired,
      topic: PropTypes.object.isRequired,
    };

    export default TopicListItem </pre>
    <p>打开topic-list/index.jsx :</p>
    <pre style="height: 500px;">// topic-list/index.jsx
    import React from 'react'
    import { observer, inject } from 'mobx-react'
    import PropTypes from 'prop-types'
    import Helmet from 'react-helmet'
    import Button from '@material-ui/core/Button'
    import Tabs from '@material-ui/core/Tabs';
    import Tab from '@material-ui/core/Tab';
    import { AppState } from '../../store/app-state'
    import Container from '../layout/container'
    import TopicListItem from './list-item'

    //inject用来注入provider上提供的东西到组件
    //observer告诉我们这个组件是observable的，它是reactive的，store里面的值一更新组件里的内容也会更新。
    @inject('appState') @observer
    export default class TopicList extends React.Component {
      constructor() {
        super();
        this.state = {
          tabIndex: 0,
        };
        this.changeName = this.changeName.bind(this);
        this.changeTab = this.changeTab.bind(this);
        this.listItemClick = this.listItemClick.bind(this);
      }

      componentDidMount() {
        // do something here
      }

      asyncBootstrap() {
        return new Promise((resolve) => {
          setTimeout(() => {
            this.props.appState.count = 3;
            resolve(true);//一定要resolve(true),asyncBootstrap会根据resolve的内容true还是false来决定这个方法有没有执行成功。
          })
        })
      }

      changeName(event) {
        this.props.appState.changeName(event.target.value)
      }

      changeTab(e, index) {
        this.setState({
          tabIndex: index,
        })
      }

      /* eslint-disable */
      listItemClick() {

      }
      /* eslint-enable */

      render() {
        const { tabIndex } = this.state;
        const topic = {
          title: 'this is title',
          username: 'jocky',
          reply_count: 20,
          visit_count: 30,
          create_at: 'sohoenasfeohn',
          tab: 'share',
          image: 'https://img5.duitang.com/uploads/item/201506/07/20150607110911_kY5cP.jpeg',
        }; //临时随便声明一个topic空对象，让页面先跑起来
        return (
          &lt;Container&gt;
            &lt;Helmet&gt;
              &lt;title&gt;this is topic list&lt;/title&gt;
              &lt;meta name="description" content="this is description" /&gt;
            &lt;/Helmet&gt;
            &lt;Tabs value={tabIndex} onChange={this.changeTab}&gt;
              &lt;Tab label="全部" /&gt;
              &lt;Tab label="分享" /&gt;
              &lt;Tab label="工作" /&gt;
              &lt;Tab label="问答" /&gt;
              &lt;Tab label="精品" /&gt;
              &lt;Tab label="测试" /&gt;
            &lt;/Tabs&gt;
            &lt;TopicListItem onClick={this.listItemClick} topic={topic} /&gt;
            &lt;Button variant="raised" color="primary"&gt;this is a button&lt;/Button&gt;
            &lt;input type="text" onChange={this.changeName} /&gt;
            &lt;span&gt;{this.props.appState.msg}&lt;/span&gt;
          &lt;/Container&gt;
        )
      }
    }

    TopicList.propTypes = {
      appState: PropTypes.instanceOf(AppState).isRequired,
    };//appState是AppState类的一个实例</pre>
    <p>定制样式控制话题列表的内容，使整个列表符合审美。在topic-list目录下新建一个style.js文件:</p>
    <pre style="height: 300px;">// topic-list/style.js
    export const topicPrimaryStyle = theme => ({
      root: {
        display: 'flex',
        alignItems: 'center',
      },
      title: {
        color: '#555',
      },
      tab: {
        backgroundColor: theme.palette.primary[500],
        textAlign: 'center',
        display: 'inline-block',
        padding: '0 6px',
        color: '#fff',
        borderRadius: 3,
        marginRight: 10,
        fontSize: '12px',
      },
    });

    export const topicSecondaryStyle = theme => ({
      root: {
        display: 'flex',
        alignItems: 'center',
        paddingTop: 3,
      },
      count: {
        textAlign: 'center',
        marginRight: 20,
      },
      userName: {
        marginRight: 20,
        color: '#9e9e9e',
      },
      accentColor: {
        color: theme.palette.accent[300],
      },
    });

    export default topicPrimaryStyle</pre>
    <h3>5,列表页面数据获取实现</h3>
    <p>接下去，需从cnode api获取列表数据。</p>
    <p>在client目录下新建一个util目录。在新建的util目录下新建一个模块文件http.js，这个文件是用来发送api接口请求的js，使用它对axios做一些封装，这样的话使用API请求会更简单一点。</p>
    <p>默认情况下访问API接口使用绝对路径就可以了，如：/api/xxx。但因为代码是需要使用服务端渲染的，服务端渲染发送请求的时候，需要发送到它本地的地址，因为是服务端在启动服务，也就是说要指定类似‘127.0.0.1’这样的地址。因为这个发送地址是存在客户端和服务端的区别的，所以需要去webpack.config.server.js做一些配置：</p>
    <pre>// webpack.config.server.js

    </pre>
    <p>然后编写http.js</p>
    <pre>// client/util/http.js

    </pre>



    <br/>
    <h5>参考文档:</h5>
    <p style="background-color: rgb(247,247,247);">● &lt;BrowserRouter&gt;：使用 HTML5 提供的 history API 来保持 UI 和 URL 的同步；</p>
</div>

</body>
</html>