<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>javascript导出文件到本地 |sumerzhou's blog</title>
    <link href="myblog.css" rel="stylesheet" type="text/css">
    <script src="myblog.js" type="text/javascript"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        .textBox{
            width: 980px;
            border-radius: 20px;
            position: relative;
            padding: 10px;
            top: 105px;
            line-height: 2em;
        }
        .textBox h2{
            margin-top: 10px;
            text-indent: 2em;
            text-shadow: 2px 2px 1px dodgerblue;
        }
        .textBox h3{
            margin-top: 10px;
            border-bottom:1px solid lightblue;
            box-shadow: 2px 2px 1px black;
        }
        .textBox h4{
            text-shadow: 1px 1px 2px #4F68B0;
        }
        .textBox p{
            text-indent: 2em;
        }
        .textBox li{
            text-indent: 2em;
            list-style: none;
        }
        .textBox pre{
            display: block;
            width: 850px;
            border-left: 1px solid black;
            border-right: 1px solid black;
            box-shadow: 4px 3px 2px black;
            padding-left: 30px;
            position: relative;
            left: -30px;
            font-family: '仿宋';
            background-color: rgb(40,44,52);
            line-height: 1.5;
            font-size: 15px;
            color:white;
            overflow-y: auto;
        }
        .highlight{
            background-color: rgb(255,243,212);
        }
    </style>
</head>
<body>
<!--header-->
<div class="headerbox">
    <div class="headertop">
        <div class="hdtopbut">
            <a href="http://blog.hungking.cc/" target="_blank"><img src="imgs/sns_blog_off.png"></a>
            <a href="https://www.facebook.com/HoungkingHsi" target="_blank"><img src="imgs/sns_facebook_off.png"></a>
            <a href="http://globalblog.hungking.cc/" target="_blank"><img src="imgs/sns_gBlog_off.png"></a>
            <a href="http://www.linkedin.com/imisslovelove" target="_blank"><img src="imgs/sns_in_off.png"></a>
            <a href="http://www.youtube.com/imisslovelove" target="_blank"><img src="imgs/sns_youTube_off.png"></a>
            <a href="http://www.instagram.com/imisslovelove" target="_blank"><img src="imgs/sns_instagram_off.png"></a>
            <a href="http://story.kakao.com/ch/imisslovelove" target="_blank" style="background: transparent none;"><img src="imgs/sns_kakao_off.png"></a>
            <div class="hdtopbutR">
                <a href="construction.html" style="background-position-x:85px ;">Contact Me</a>
                <a href="construction.html">AboutSite</a>
                <span onclick="ifshow(0)">Language<img src="imgs/btn_globalSite_open.gif"></span>
                <ul id="lag">
                    <li>KOREAN</li><li>CHINESE</li><li>JAPANESE</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="headerbotm">
        <a class="logohome" href="http://www.hungking.cc/company"><img src="imgs/blog.png"></a>
        <ul id="hdbotmUl">
            <li>
                <a href="company.html">WEB前端</a>
                <ul class="ultext1">
                    <li>
                        <a href="">HTML</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Corporate Overview</a></li>
                                <li><a href="">Vision of houngking</a></li>
                                <li><a href="">History of houngking</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">CSS/CSS3</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Brand Story</a></li>
                                <li><a>CI</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">JavaScript</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Greetings</a></li>
                                <li><a>CEO's Message</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Ajax</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>hougking Affiliates</a></li>
                                <li><a>Steel</a></li>
                                <li><a>E&C</a></li>
                                <li><a>Trade</a></li>
                                <li><a>ICT</a></li>
                                <li><a>Energy</a></li>
                                <li><a>Material-Chemistry</a></li>
                                <li><a>Support</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">jQuery</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Global</a></li>
                                <li><a>Asia</a></li>
                                <li><a>America</a></li>
                                <li><a>Europe&Africa</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Business Ethics</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Code of Ethics</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">CEO Message</a></li>
                                <li><a href="">Ethics Charter</a></li>
                                <li><a href="">Practice Guidelines</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Major Activities</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Operation of the Ethical Management System</a></li>
                                <li><a href="">Education on Corporate Ethics</a></li>
                                <li><a href="">Unethical Act Prevention System</a></li>
                                <li><a href="">External Activities and Results</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Products/Technology</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Products of hounking</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Hot Rolled Steel</a></li>
                                <li><a href="">Steel Plate</a></li>
                                <li><a href="">Winter Day</a></li>
                                <li><a href="">Gold Rolled Steel</a></li>
                                <li><a href="">Galvanized Steel</a></li>
                                <li><a href="">Electrical Galvanized</a></li>
                                <li><a href="">Electrical Steel</a></li>
                                <li><a href="">Automotive materials</a></li>
                                <li><a href="">Stainless Steel</a></li>
                                <li><a href="">Titanium Product</a></li>
                                <li><a href="">Magnesium Product</a></li>
                                <li><a href="">Aluminum-plated products</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">houngking Technology</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">FINEX Technology</a></li>
                                <li><a href="">Strip Casting</a></li>
                                <li><a href="">Endless Hot Rolling Technology</a></li>
                                <li><a href="">Operation Technology</a></li>
                                <li><a href="">CEM Technology</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Production Process</a>
                    </li>
                    <li>
                        <a href="">Sales information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">e-Sales</a></li>
                                <li><a href="">e-Procurement</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Investor Relations</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">IR Activeties</a>
                    </li>
                    <li>
                        <a href="">Stock Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Stock Price</a></li>
                                <li><a href="">Price Comparision</a></li>
                                <li><a href="">ADR</a></li>
                                <li><a href="">houngking Stock Exchange</a></li>
                                <li><a href="">Economic Trend</a></li>
                                <li><a href="">Shareholders Demographics</a></li>
                                <li><a href="">Dividend</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Financial Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Income Statement</a></li>
                                <li><a href="">Credit Rating</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">IR Archive</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Audit Report</a></li>
                                <li><a href="">Form 20-F</a></li>
                                <li><a href="">Annual Report</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Sustainability</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Sustainability Management System</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Management System</a></li>
                                <li><a href="">houngking Subsidiaries CSR Assessment</a></li>
                                <li><a href="">Risk Management</a></li>
                                <li><a href="">Stakeholder</a></li>
                                <li><a href="">Relevant Institutes Activities</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Social Responsibility </a>
                    </li>
                    <li>
                        <a href="">Environmental Management </a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Family's Environmental Management</a></li>
                                <li><a href="">Environmental Management</a></li>
                                <li><a href="">Climate change /Energy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Customer</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Marketing strategy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Employee</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Employee Health / Safety</a></li>
                                <li><a href="">Organizational Culture</a></li>
                                <li><a href="">HR system</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Report</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Report</a></li>
                                <li><a href="">Carbon Report</a></li>
                                <li><a href="">Conflict Minerals Disclosure</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">PR Room</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">News room</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">News letter</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">houngking SNS</a>
                    </li>
                    <li>
                        <a href="">PR Archives</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Digital Brochure</a></li>
                                <li><a href="">TV Cormmercials</a></li>
                                <li><a href="">Screen Saver</a></li>
                                <li><a href="">PR Movies</a></li>
                                <li><a href="">Printed Advertisement</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Download</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Company</a></li>
                                <li><a href="">Products/Technology</a></li>
                                <li><a href="">Investor Relations</a></li>
                                <li><a href="">Sustainability</a></li>
                                <li><a href="">PR Room</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <img src="imgs/btn_gnb.png" class="imgbtn" id="imgbtn" onclick="ifshow(1)">
        <img src="imgs/btn_search.png" class="imgbtn2" onclick="ifshow(2)">
        <div class="hdmenu" id="hdmenu">
            <a href="">Open submenu</a>
            <ul class="menutxt1">
                <li>
                    <a href="">Company</a>
                    <ul>
                        <li><a href="">Corporate Overview</a></li>
                        <li><a href="">Brand</a></li>
                        <li><a href="">CEO</a></li>
                        <li><a href="">hounking Affiliates</a></li>
                        <li><a href="">hounking Overseas</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Business Ethics</a>
                    <ul>
                        <li><a href="">Code of Ethics</a></li>
                        <li><a href="">Major Activities</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Products/Technology</a>
                    <ul>
                        <li><a href="">Products of houngking</a></li>
                        <li><a href="">hounking Technology</a></li>
                        <li><a href="">Production Process</a></li>
                        <li><a href="">Sales informtion</a></li>
                    </ul>
                </li>
                <li style="padding: 0px;">
                    <a href="">Investor Relations</a>
                    <ul>
                        <li><a href="">IR Activities</a></li>
                        <li><a href="">Stock Information</a></li>
                        <li><a href="">Financial Information</a></li>
                        <li><a href="">IR Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Sustainability</a>
                    <ul>
                        <li><a href="">Suatainability Management System</a></li>
                        <li><a href="">Social Redponsibility</a></li>
                        <li><a href="">Environmental Management</a></li>
                        <li><a href="">Customer</a></li>
                        <li><a href="">Employee</a></li>
                        <li><a href="">Report</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">PR Room</a>
                    <ul>
                        <li><a href="">Newsroom</a></li>
                        <li><a href="">Newsletter</a></li>
                        <li><a href="">houngking SNS</a></li>
                        <li><a href="">PR Archives</a></li>
                        <li><a href="">Download</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Contact Us</a>
                    <ul>
                        <li><a href="">Q&A</a></li>
                        <li><a href="">Search</a></li>
                        <li><a href="">Location</a></li>
                        <li><a href="">Sitemap</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--text-->
<div class="textBox">
    <h2>javascript导出文件到本地 </h2>
    <h3>1,jQuery适用</h3>
    <h4>>>  jquery插件导出word：jquery.wordexport.js</h4>
    <h5>需要的js文件如下，贴出github地址:</h5>
    <p>https://github.com/eligrey/FileSaver.js/</p>
    <p>https://github.com/markswindoll/jQuery-Word-Export</p>
    <h5>首先要引入jquery 和FileSaver.js:</h5>
    <p>一定先引入以上两文件之后再引入jquery.wordexport.js:</p>
    <pre> &lt;script src="jquery.wordexport.js"&gt; &lt;/script&gt; </pre>
    <h5>实现代码很简单:</h5>
    <pre> $("#exportWord").wordExport(FineName) //FineName为导出后生成的文件名。</pre>
    <p></p>
    <h5>我的HTML/JS：</h5>
    <pre>
    &lt;div id="exportWord" &gt;
        &lt;h2 style="text-align: center;"&gt; 斑马线调试参数 &lt;/h2&gt;
        &lt;div id="printWord"&gt;&lt;/div&gt;
    &lt;/div&gt;
    // JS ---------------------
    function saveDownToLocal() {
        var htmlstr = $(".export-part-one").html() + $(".export-part-two").html();
	    $('#printWord').html(htmlstr);
	    $("#exportWord").wordExport('斑马线调试参数');
    }</pre>
    <p>可以动态设置需要导出的内容。比方例子里，把页面上$(".export-part-one")和$(".export-part-two")里的内容搬到了需要导出的$("#exportWord")中。导出的只是页面的一部分，网页上有样式，也可以按照的需求自己添加相应的样式到#exportWord的div内。</p>
    <h4>>> 生成本地txt文件 </h4>
    <p>很难实现直接创建文件到本地，因为权限不允许。</p>
    <p>直接调用这个插件即可：https://github.com/eligrey/FileSaver.js/blob/master/FileSaver.js</p>
    <pre>// Saving text
var blob = new Blob([JSON.stringify(paramsData)], {type: "text/plain;charset=utf-8"});
saveAs(blob, "斑马线调试参数.txt");  </pre>


    <h4>>> 导出excel</h4>
    <h5>jquery.table2excel.js插件</h5>
    <h5>ExcellentExport.js:</h5>
    <p>它主要就是个抓取table标签，然后导出为Excel的插件，支持导出xls、CSV，很简单的一款插件，参数填上table id即可,傻瓜式导出table ,功能单一，比较局限。</p>
    <h5>Exceljs:</h5>
    <p>github：https://github.com/guyonroche/exceljs </p>
    <p>优点：对单元格的定制很全面，适合对表格样式有要求的人 </p>
    <p>缺点：选项多就意味着代码多，另外支持的格式不够丰富</p>
    <h5>js-xlsx:</h5>
    <p>优点：支持格式最全面，尤其是读取文件方面，什么老古董格式都能读取，有很多延伸插件，可以选择使用</p>
    <p>缺点：不是很好弄，相比较而言还是麻烦一些的。 </p>
    <p>github里面有三个例子，各种导出都有。关键点：</p>
    <p>1) Exceljs和js-xlsx都有关于使用node和不使用node的不同用法，注意区别使用，不过看似node用法很简单</p>
    <p>2) 需要用到require()的地方是node的部分，可以参考我的另一篇关于requirejs的文章，例子中用到require()的地方跳过即可</p>
    <h5>xlsx - npm</h5>
    <p><a href="https://www.npmjs.com/package/xlsx" target="_blank">xlsx插件</a>可以设置导出的excel表格的简单格式，比如合并单元格。</p>
    <h4>>> 在线预览pdf的pdf.js</h4>
    <h4>>> 在线预览excel -- sheet.js</h4>
    

    <h3>2,node适用</h3>
    <h4>>> node-xlsx</h4>
	
    <h3>3,不使用插件的方法</h3>
    <h4>Web 端 js 导出csv文件(使用a标签):</h4>
    <p>导出文件，使用最多的方式还是服务器端来处理。比如jsp 中使用response 的方式。</p>
    <p>在IE中使用ActiveXObject 实现，在firefox 和Chrome 中使用  a 标签（或者js）就可以实现了。 这里主要讲一下其他浏览器中的实现。</p>
    <h5>使用 a 标签实现方式:</h5>
    <pre> &lt;a id="test" download="downlaod.txt" href="data:text/txt;charset=utf-8,download Test Data"&gt;download&lt;/a&gt;
    //download 设置下载的文件名。
    //href 加上 data:text/txt;charset=utf-8  分别设置点击link 是下载文件， 编码是utf-8 . 这个逗号后面的就是保存在文件中的内容了。</pre>
    <h5>以多行，多列导出csv 文件:</h5>
    <p>csv 文件可以用Excel打开， 如果是导出一个table 的话，使用Excel 就方便很多了。</p>
    <p>问题是： 如何分行， 分列？</p>
    <p>理论上 ： 分列使用 ， 号分割， 分行用 \n .</p>
    <p>可以用以上方式，会发现列可以分开，但是不换行。 看上去不认识 \n.</p>
    <p>解决方式是使用 encodeURIComponent 进行编码/</p>
    <pre>
function clickDownload(aLink) {
         var str = "col1,col2,col3\nvalue1,value2,value3";
         str =  encodeURIComponent(str);
         aLink.href = "data:text/csv;charset=utf-8,"+str;
         aLink.click();
 }
---------------------
&lt;a id="test" onclick="clickDownload(this)" download="downlaod.csv" href="#"&gt;download&lt;/a&gt; </pre>
    <h5>带中文问题的csv 导出:</h5>
    <p>以上使用的都是utf-8 编码，理论上导出中文应该不是问题。但是导出csv 格式的话， 使用Excel 打开会发现中文是乱码，但是用其他文本程序打开确是正常的。原因就是少了一个 BOM头 。  \ufeff。加上一切都正常了，</p>
    <pre>
&lt;meta http-equiv="content-type" content="text/html; charset=gb2312"&gt;
-----------------------------------
function clickDownload(aLink){
         var str = "栏位1,栏位2,栏位3\n值1,值2,值3";
         str =  encodeURIComponent(str);
         aLink.href = "data:text/csv;charset=utf-8,\ufeff"+str;
         aLink.click();
 }
//这里有两个改变 :1. 页面的charset 需设置成gb2312; 2. 加上 \ufeff BOM 头</pre>
    <h5>Chrome下载的文件名:</h5>
    <p>以上使用 a 的download 属性可以指定下载的文件名及后缀。 但是在Chrome 执行的时候会发现， Chrome 压根不理会这个。</p>
    <p>下载名是 "下载" 或是 "download".</p>
    <p>上网搜索一下， 有说是Chrome 的 bug,参见 stackoverflow 中的两篇文章：</p>
    <p>http://stackoverflow.com/questions/23962284/download-attribute-on-a-tag-doesnt-work-in-chrome</p>
    <p>http://stackoverflow.com/questions/23816005/anchor-tag-download-attribute-not-working-bug-in-chrome-35-0-1916-114</p>
    <p>解决方案：</p>
    <pre>
 var blob = new Blob([data], { type: 'text/csv' }); //new way
 var csvUrl = URL.createObjectURL(blob);
 document.getElementById("mylink").href = csvUrl;  </pre>
    <p>使用Blob 和URL 来封装和转换. 问题解决。</p>
    <p>这里如遇中文问题， 和上面的处理方式是一样的：1. 页面的charset 需设置成gb2312 （设成UTF-8 也可以）; 2. 加上 \ufeff BOM 头。具体的代码类似：</p>
    <pre>
data = "\ufeff"+data;
var blob = new Blob([data], { type: 'text/csv,charset=UTF-8'});  </pre>
    <h4>HTML用JS导出Excel的五种方法:</h4>
	

    <br/>
    <h5>参考文档:</h5>
    <a href="http://www.cnblogs.com/kmonkeywyl/p/9896448.html" target="_blank">jquery插件导出word：jquery.wordexport.js</a>, <br>
    <a href="https://www.cnblogs.com/itafter/p/4379988.html" target="_blank">js jquery jquery.wordexport.js 实现导出word</a>, <br>
    <a href="https://blog.csdn.net/oscar999/article/details/16342699" target="_blank">Web 端 js 导出csv文件(使用a标签)</a>,<br>
    <a href="https://blog.csdn.net/aa122273328/article/details/50388673" target="_blank">HTML用JS导出Excel的五种方法</a>,<br>
</div>

</body>
</html>
