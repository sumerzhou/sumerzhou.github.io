<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS易错点整理|sumerzhou's blog</title>
    <link href="myblog.css" rel="stylesheet" type="text/css">
    <script src="myblog.js" type="text/javascript"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        .textBox{
            width: 980px;
            border-radius: 20px;
            position: relative;
            padding: 10px;
            top: 105px;
            line-height: 2em;
        }
        .textBox h2{
            margin-top: 10px;
            text-indent: 2em;
            text-shadow: 2px 2px 1px dodgerblue;
        }
        .textBox h3{
            margin-top: 10px;
            border-bottom:1px solid lightblue;
            box-shadow: 2px 2px 1px black;
        }
        .textBox h4{
            text-shadow: 1px 1px 2px #4F68B0;
        }
        .textBox p{
            text-indent: 2em;
        }
        .textBox li{
            text-indent: 2em;
            list-style: none;
        }
        .textBox pre{
            display: block;
            width: 850px;
            border-left: 1px solid black;
            border-right: 1px solid black;
            box-shadow: 2px 2px 1px black;
            padding-left: 30px;
            position: relative;
            left: -30px;
            font-family: '仿宋';
        }
    </style>
</head>
<body>
<!--header-->
<div class="headerbox">
    <div class="headertop">
        <div class="hdtopbut">
            <a href="http://blog.hungking.cc/" target="_blank"><img src="imgs/sns_blog_off.png"></a>
            <a href="https://www.facebook.com/HoungkingHsi" target="_blank"><img src="imgs/sns_facebook_off.png"></a>
            <a href="http://globalblog.hungking.cc/" target="_blank"><img src="imgs/sns_gBlog_off.png"></a>
            <a href="http://www.linkedin.com/imisslovelove" target="_blank"><img src="imgs/sns_in_off.png"></a>
            <a href="http://www.youtube.com/imisslovelove" target="_blank"><img src="imgs/sns_youTube_off.png"></a>
            <a href="http://www.instagram.com/imisslovelove" target="_blank"><img src="imgs/sns_instagram_off.png"></a>
            <a href="http://story.kakao.com/ch/imisslovelove" target="_blank" style="background: transparent none;"><img src="imgs/sns_kakao_off.png"></a>
            <div class="hdtopbutR">
                <a href="construction.html" style="background-position-x:85px ;">Contact Me</a>
                <a href="construction.html">AboutSite</a>
                <span onclick="ifshow(0)">Language<img src="imgs/btn_globalSite_open.gif"></span>
                <ul id="lag">
                    <li>KOREAN</li><li>CHINESE</li><li>JAPANESE</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="headerbotm">
        <a class="logohome" href="http://www.hungking.cc/company"><img src="imgs/blog.png"></a>
        <ul id="hdbotmUl">
            <li>
                <a href="company.html">WEB前端</a>
                <ul class="ultext1">
                    <li>
                        <a href="">HTML</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Corporate Overview</a></li>
                                <li><a href="">Vision of houngking</a></li>
                                <li><a href="">History of houngking</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">CSS/CSS3</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Brand Story</a></li>
                                <li><a>CI</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">JavaScript</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Greetings</a></li>
                                <li><a>CEO's Message</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Ajax</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>hougking Affiliates</a></li>
                                <li><a>Steel</a></li>
                                <li><a>E&C</a></li>
                                <li><a>Trade</a></li>
                                <li><a>ICT</a></li>
                                <li><a>Energy</a></li>
                                <li><a>Material-Chemistry</a></li>
                                <li><a>Support</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">jQuery</a>
                        <div class="ultext2">
                            <ul>
                                <li><a>Global</a></li>
                                <li><a>Asia</a></li>
                                <li><a>America</a></li>
                                <li><a>Europe&Africa</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Business Ethics</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Code of Ethics</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">CEO Message</a></li>
                                <li><a href="">Ethics Charter</a></li>
                                <li><a href="">Practice Guidelines</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Major Activities</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Operation of the Ethical Management System</a></li>
                                <li><a href="">Education on Corporate Ethics</a></li>
                                <li><a href="">Unethical Act Prevention System</a></li>
                                <li><a href="">External Activities and Results</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Products/Technology</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Products of hounking</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Hot Rolled Steel</a></li>
                                <li><a href="">Steel Plate</a></li>
                                <li><a href="">Winter Day</a></li>
                                <li><a href="">Gold Rolled Steel</a></li>
                                <li><a href="">Galvanized Steel</a></li>
                                <li><a href="">Electrical Galvanized</a></li>
                                <li><a href="">Electrical Steel</a></li>
                                <li><a href="">Automotive materials</a></li>
                                <li><a href="">Stainless Steel</a></li>
                                <li><a href="">Titanium Product</a></li>
                                <li><a href="">Magnesium Product</a></li>
                                <li><a href="">Aluminum-plated products</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">houngking Technology</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">FINEX Technology</a></li>
                                <li><a href="">Strip Casting</a></li>
                                <li><a href="">Endless Hot Rolling Technology</a></li>
                                <li><a href="">Operation Technology</a></li>
                                <li><a href="">CEM Technology</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Production Process</a>
                    </li>
                    <li>
                        <a href="">Sales information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">e-Sales</a></li>
                                <li><a href="">e-Procurement</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Investor Relations</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">IR Activeties</a>
                    </li>
                    <li>
                        <a href="">Stock Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Stock Price</a></li>
                                <li><a href="">Price Comparision</a></li>
                                <li><a href="">ADR</a></li>
                                <li><a href="">houngking Stock Exchange</a></li>
                                <li><a href="">Economic Trend</a></li>
                                <li><a href="">Shareholders Demographics</a></li>
                                <li><a href="">Dividend</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Financial Information</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Income Statement</a></li>
                                <li><a href="">Credit Rating</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">IR Archive</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Audit Report</a></li>
                                <li><a href="">Form 20-F</a></li>
                                <li><a href="">Annual Report</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">Sustainability</a>
                <ul class="ultext1">
                    <li>
                        <a href="">Sustainability Management System</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Management System</a></li>
                                <li><a href="">houngking Subsidiaries CSR Assessment</a></li>
                                <li><a href="">Risk Management</a></li>
                                <li><a href="">Stakeholder</a></li>
                                <li><a href="">Relevant Institutes Activities</a></li>
                            </ul>
                        </div>
                    </li>
                    <li style="background-image: none;">
                        <a href="">Social Responsibility </a>
                    </li>
                    <li>
                        <a href="">Environmental Management </a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Family's Environmental Management</a></li>
                                <li><a href="">Environmental Management</a></li>
                                <li><a href="">Climate change /Energy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Customer</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Marketing strategy</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Employee</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Employee Health / Safety</a></li>
                                <li><a href="">Organizational Culture</a></li>
                                <li><a href="">HR system</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Report</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Sustainability Report</a></li>
                                <li><a href="">Carbon Report</a></li>
                                <li><a href="">Conflict Minerals Disclosure</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <a href="company.html">PR Room</a>
                <ul class="ultext1">
                    <li style="background-image: none;">
                        <a href="">News room</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">News letter</a>
                    </li>
                    <li style="background-image: none;">
                        <a href="">houngking SNS</a>
                    </li>
                    <li>
                        <a href="">PR Archives</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Digital Brochure</a></li>
                                <li><a href="">TV Cormmercials</a></li>
                                <li><a href="">Screen Saver</a></li>
                                <li><a href="">PR Movies</a></li>
                                <li><a href="">Printed Advertisement</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="">Download</a>
                        <div class="ultext2">
                            <ul>
                                <li><a href="">Company</a></li>
                                <li><a href="">Products/Technology</a></li>
                                <li><a href="">Investor Relations</a></li>
                                <li><a href="">Sustainability</a></li>
                                <li><a href="">PR Room</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <img src="imgs/btn_gnb.png" class="imgbtn" id="imgbtn" onclick="ifshow(1)">
        <img src="imgs/btn_search.png" class="imgbtn2" onclick="ifshow(2)">
        <div class="hdmenu" id="hdmenu">
            <a href="">Open submenu</a>
            <ul class="menutxt1">
                <li>
                    <a href="">Company</a>
                    <ul>
                        <li><a href="">Corporate Overview</a></li>
                        <li><a href="">Brand</a></li>
                        <li><a href="">CEO</a></li>
                        <li><a href="">hounking Affiliates</a></li>
                        <li><a href="">hounking Overseas</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Business Ethics</a>
                    <ul>
                        <li><a href="">Code of Ethics</a></li>
                        <li><a href="">Major Activities</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Products/Technology</a>
                    <ul>
                        <li><a href="">Products of houngking</a></li>
                        <li><a href="">hounking Technology</a></li>
                        <li><a href="">Production Process</a></li>
                        <li><a href="">Sales informtion</a></li>
                    </ul>
                </li>
                <li style="padding: 0px;">
                    <a href="">Investor Relations</a>
                    <ul>
                        <li><a href="">IR Activities</a></li>
                        <li><a href="">Stock Information</a></li>
                        <li><a href="">Financial Information</a></li>
                        <li><a href="">IR Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Sustainability</a>
                    <ul>
                        <li><a href="">Suatainability Management System</a></li>
                        <li><a href="">Social Redponsibility</a></li>
                        <li><a href="">Environmental Management</a></li>
                        <li><a href="">Customer</a></li>
                        <li><a href="">Employee</a></li>
                        <li><a href="">Report</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">PR Room</a>
                    <ul>
                        <li><a href="">Newsroom</a></li>
                        <li><a href="">Newsletter</a></li>
                        <li><a href="">houngking SNS</a></li>
                        <li><a href="">PR Archives</a></li>
                        <li><a href="">Download</a></li>
                    </ul>
                </li>
                <li>
                    <a href="">Contact Us</a>
                    <ul>
                        <li><a href="">Q&A</a></li>
                        <li><a href="">Search</a></li>
                        <li><a href="">Location</a></li>
                        <li><a href="">Sitemap</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--text-->
<div class="textBox">
    <h2>JS易错点整理</h2>
    <p>本文从变量作用域，类型比较，this指向，函数参数，闭包问题及对象拷贝与赋值这6个方面进行由浅入深的介绍和讲解，其中也涉及了一些ES6的知识点。</p>
    <h3>1,变量作用域</h3>
    <pre>
        var a = 1;
        function test() {
            var a = 2;
            console.log(a); // 2
        }
        test();</pre>
    <p>上方的函数作用域中声明并赋值了a，且在console之上，所以遵循就近原则输出a等于2。</p>
    <pre>
        var a = 1;
        function test2() {
            console.log(a); // undefined
            var a = 2;
        }
        test2();</pre>
    <p>上方的函数作用域中虽然声明并赋值了a，但位于console之下，a变量被提升，输出时已声明但尚未被赋值，所以输出undefined。</p>
    <pre>
        var a = 1;
        function test3() {
            console.log(a); // 1
            a = 2;
        }
        test3();</pre>
    <p>上方的函数作用域中a被重新赋值，未被重新声明，且位于console之下，所以输出全局作用域中的a。</p>
    <pre>
        let b = 1;
        function test4() {
            console.log(b); // b is not defined
            let b = 2;
        }
        test4();</pre>
    <p>上方函数作用域中使用了ES6的let重新声明了变量b，而let不同于var其不存在变量提升的功能，所以输出报错b is not defined。</p>
    <pre>
        function test5() {
            let a = 1;
            { let a = 2; }
            console.log(a); // 1
        }
        test5();</pre>
    <p>上方的函数作用域中用let声明了a为1，并在块级作用域中声明了a为2，因为console并不在函数内的块级作用域中，所以输出1。</p>
    <h3>2,类型比较</h3>
    <pre>
        var arr = [],arr2 = [];
        console.log(arr === arr2); // false</pre>
    <p>上方两个相同的数组比较，因为两个单独的数组永不相等，所以console为false。</p>
    <pre>
        var arr = [],arr2 = {};
        console.log(typeof(arr) === typeof(arr2)); // true</pre>
    <p>上方利用typeof比较数组和对象，因为typeof获取NULL、数组、对象的类型都为object，所以console为true。</p>
    <pre>
        var arr = [];
        console.log(arr instanceof Object); // true
        console.log(arr instanceof Array); // true</pre>
    <p>上方利用instanceof判断一个变量是否属于某个对象的实例，因为在JavaScript中数组也是对象的一种，所以两个console都为true。</p>
    <h3>3,this指向</h3>
    <pre>
        var obj = {
            name: 'xiaoming',
            getName: function () {
                return this.name
            }
        };
        console.log(obj.getName());  // 'xiaoming'</pre>
    <p>上方对象方法中的this指向对象本身，所以输出xiaoming。</p>
    <pre>
        var obj = {
            myName: 'xiaoming',
            getName: function () {
                return this.myName
            }
        };
        var nameFn = obj.getName;
        console.log(nameFn()); // undefined</pre>
    <p>上方将对象中的方法赋值给了一个变量，此时方法中的this也将不再指向obj对象，从而指向window对象，所以console为undefined。</p>
    <pre>
        var obj = {
            myName: 'xiaoming',
            getName: function () {
                return this.myName
            }
        };
        var obj2 = {
            myName: 'xiaohua'
        };
        var nameFn = obj.getName;
        console.log(nameFn.apply(obj2)); // 'xiaohua'</pre>
    <p>上方同样将obj对象中的方法赋值给了变量nameFn，但是通过apply方法将this指向了obj2对象，所以最终console为xiaohua。</p>
    <h3>4,函数参数</h3>
    <pre>
        function test6() {
            console.log(Array.prototype.slice.call(arguments)); // [1, 2]
        }
        test6(1, 2);</pre>
    <p>上方利用函数中的arguments类数组对象获取传入函数的参数数组，所以输出数组[1, 2]。</p>
    <pre>
        function test7 () {
            return function () {
                console.log(Array.prototype.slice.call(arguments));
            }
        }
        test7(1, 2); // 未执行return中的函数，无输出
        test7(1, 2)(3, 4); //输出[3, 4]</pre>
    <pre>
        var args = [1, 2];
        function test9() {
            console.log(Array.prototype.slice.call(arguments)); // [1, 2, 3, 4]
        }
        Array.prototype.push.call(args, 3, 4);
        test9(...args);</pre>
    <p>上方利用Array.prototype.push.call()方法向args数组中插入了3和4，并利用ES6延展操作符(...)将数组展开并传入test9，所以console为[1, 2, 3, 4]。</p>
    <h3>5,闭包问题</h3>
    <pre>
        var elem = document.getElementsByTagName('div'); // 如果页面上有5个div
        for(var i = 0; i < elem.length; i++) {
            elem[i].onclick = function () {
                alert(i); // 总是5
            };
        }</pre>
    <p>上方是一个很常见闭包问题，点击任何div弹出的值总是5，因为当你触发点击事件的时候i的值早已是5，可以用下面方式解决：</p>
    <pre>
        var elem = document.getElementsByTagName('div'); // 如果页面上有5个div
        for(var i = 0; i < elem.length; i++) {
            (function (w) {
                elem[w].onclick = function () {
                    alert(w); // 依次为0,1,2,3,4
                };
            })(i);
        }</pre>
    <p>在绑定点击事件外部封装一个立即执行函数，并将i传入该函数即可。</p>
    <p>PS:绑定点击事件时，合理使用this或新增对象属性的方法,也能解决闭包带来的一些问题。</p>
    <h3>6,对象拷贝与赋值</h3>
    <pre>
        var obj = {
            name: 'xiaoming',
            age: 23
        };
        var newObj = obj;
        newObj.name = 'xiaohua';
        console.log(obj.name); // 'xiaohua'
        console.log(newObj.name); // 'xiaohua'</pre>
    <p>上方我们将obj对象赋值给了newObj对象，从而改变newObj的name属性，但是obj对象的name属性也被篡改，这是因为实际上newObj对象获得的只是一个内存地址，而不是真正的拷贝，所以obj对象被篡改。</p>
    <pre>
        var obj2 = {
            name: 'xiaoming',
            age: 23
        };
        var newObj2 = Object.assign({}, obj2, {color: 'blue'});
        newObj2.name = 'xiaohua';
        console.log(obj2.name); // 'xiaoming'
        console.log(newObj2.name); // 'xiaohua'
        console.log(newObj2.color); // 'blue'</pre>
    <p>上方利用Object.assign()方法进行对象的深拷贝可以避免源对象被篡改的可能。因为Object.assign() 方法可以把任意多个的源对象自身的可枚举属性拷贝给目标对象，然后返回目标对象。但是Object.assign() 只是一级属性复制，比浅拷贝多深拷贝了一层，使用的时候，还要注意这个问题。</p>
    <pre>
        var obj3 = {
            name: 'xiaoming',
            age: 23
        };
        var newObj3 = Object.create(obj3);
        newObj3.name = 'xiaohua';
        console.log(obj3.name); // 'xiaoming'
        console.log(newObj3.name); // 'xiaohua'</pre>
    <p>也可以使用Object.create()方法进行对象的拷贝，Object.create()方法可以创建一个具有指定原型对象和属性的新对象。</p>
    <h3>7,函数本身的作用域</h3>
    <p>作用域（scope）指的是变量存在的范围。Javascript只有两种作用域：一种是全局作用域，变量在整个程序中一直存在，所有地方都可以读取，在全局作用域中声明的变量称为全局变量；另一种是局部作用域，变量只在函数内部存在，此时的变量被称为局部变量。</p>
    <p>函数本身也是一个值，也有自己的作用域。它的作用域与变量一样，就是其声明时所在的作用域，与其运行时所在的作用域无关。</p>
    <pre>
        var a = 1;
        var b = function (){
           console.log(a);
        };
        function c(){
           var a = 2;
           b();
        }
        c();  //1</pre>
    <pre>
        var a = 1;
        var b = function {
            return a;
        };
        function c() {
            var a = 2;
            return b();
        }
        console.log(c()); //1</pre>
    <p>以上两个代码段相同。函数b是在函数c外部声明的。所以它的作用域绑定在函数外层，内部函数a不会到函数c体内取值，所以返回的是1，而不是2。</p>
    <p>很容易犯错的一点是，如果函数A调用函数B，却没考虑到函数B不会引用函数A的内部变量。</p>
    <pre>
        var b = function (){
            console.log(a);
        };
        function c(f) {
            var a = 1;
            f();
        }
        c(b); //Uncaught ReferenceError: a is not defined</pre>
    <pre>
        var b = function {
            return a;
        };
        function c(f) {
            var a = 1;
            return f;
        }
        console.log(c(b)); //Uncaught ReferenceError: a is not defined</pre>
    <p>上面代码将函数b作为参数，传入函数c。但是，函数b是在函数c体外声明的，作用域绑定外层，因此找不到函数c的内部变量a，导致报错。</p>
    <p>同样的，函数体内部声明的变量，作用域绑定在函数体内部。</p>
    <pre>
        function fun() {
            var a = 1;
            function rascal {
                console.log(a);
            }
            return rascal;
        }
        var a = 2;
        var f = fun();
        f(); //1</pre>
    <p>上面代码中，函数fun内部声明了rascal变量。rascal作用域绑定在fun上。当我们在fun外部取出rascal执行时，变量a指向的是fun内部的a，而不是fun外部的a。这里涉及到函数另外一个重要的知识点，即在一个函数内部定义另外一个函数，也就是闭包的概念。</p>
    <p>总之，函数执行时所在的作用域，是定义时的作用域，而不是调用时所在的作用域。</p>
    <br/>
    <h4>参考文档：</h4><a href="https://www.jianshu.com/p/1c77853d4f01" target="_blank">https://www.jianshu.com/p/1c77853d4f01</a>


</div>

</body>
</html>
